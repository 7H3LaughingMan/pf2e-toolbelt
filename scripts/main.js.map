{
  "version": 3,
  "sources": ["../src/module.js", "../src/modules/arp.js", "../src/modules/shared/hook.js", "../src/modules/effects.js", "../src/apps/giveth/popup.js", "../src/modules/giveth.js", "../src/apps/knowledges/lores.js", "../src/modules/knowledges.js", "../src/apps/merge/multi.js", "../src/modules/merge.js", "../src/modules/nobulk.js", "../src/modules/summary.js", "../src/modules/unided.js", "../src/main.js"],
  "sourcesContent": ["export const MODULE_ID = 'pf2e-toolbelt'\r\n\r\nexport function getSetting(setting) {\r\n    return game.settings.get(MODULE_ID, setting)\r\n}\r\n\r\nexport function localize(...args) {\r\n    let [key, data] = args\r\n    key = `${MODULE_ID}.${key}`\r\n    if (data) return game.i18n.format(key, data)\r\n    return game.i18n.localize(key)\r\n}\r\n\r\nexport function hasLocalization(key) {\r\n    return game.i18n.has(`${MODULE_ID}.${key}`, false)\r\n}\r\n\r\nexport function localizePath(key) {\r\n    return `${MODULE_ID}.${key}`\r\n}\r\n\r\nexport function subLocalize(subKey) {\r\n    const fn = (...args) => localize(`${subKey}.${args[0]}`, args[1])\r\n\r\n    Object.defineProperties(fn, {\r\n        warn: {\r\n            value: (...args) => warn(`${subKey}.${args[0]}`, args[1], args[2]),\r\n            enumerable: false,\r\n            configurable: false,\r\n        },\r\n        info: {\r\n            value: (...args) => info(`${subKey}.${args[0]}`, args[1], args[2]),\r\n            enumerable: false,\r\n            configurable: false,\r\n        },\r\n        error: {\r\n            value: (...args) => error(`${subKey}.${args[0]}`, args[1], args[2]),\r\n            enumerable: false,\r\n            configurable: false,\r\n        },\r\n        has: {\r\n            value: key => hasLocalization(`${subKey}.${key}`),\r\n            enumerable: false,\r\n            configurable: false,\r\n        },\r\n        path: {\r\n            value: key => localizePath(`${subKey}.${key}`),\r\n            enumerable: false,\r\n            configurable: false,\r\n        },\r\n        template: {\r\n            value: (key, { hash }) => fn(key, hash),\r\n            enumerable: false,\r\n            configurable: false,\r\n        },\r\n    })\r\n\r\n    return fn\r\n}\r\n\r\nfunction notify(str, arg1, arg2, arg3) {\r\n    const type = typeof arg1 === 'string' ? arg1 : 'info'\r\n    const data = typeof arg1 === 'object' ? arg1 : typeof arg2 === 'object' ? arg2 : undefined\r\n    const permanent = typeof arg1 === 'boolean' ? arg1 : typeof arg2 === 'boolean' ? arg2 : arg3 ?? false\r\n\r\n    ui.notifications.notify(localize(str, data), type, { permanent })\r\n}\r\n\r\nexport function warn(...args) {\r\n    const [str, arg1, arg2] = args\r\n    notify(str, 'warning', arg1, arg2)\r\n}\r\n\r\nexport function info(...args) {\r\n    const [str, arg1, arg2] = args\r\n    notify(str, 'info', arg1, arg2)\r\n}\r\n\r\nexport function error(...args) {\r\n    const [str, arg1, arg2] = args\r\n    notify(str, 'error', arg1, arg2)\r\n}\r\n\r\nexport function registerWrapper(path, callback) {\r\n    libWrapper.register(MODULE_ID, path, callback)\r\n}\r\n\r\nexport function getFlag(doc, key, fallback) {\r\n    return doc.getFlag(MODULE_ID, key) ?? fallback\r\n}\r\n\r\nexport function setFlag(doc, key, value) {\r\n    return doc.setFlag(MODULE_ID, key, value)\r\n}\r\n\r\nexport function templatePath(...path) {\r\n    path = path.filter(x => typeof x === 'string')\r\n    return `modules/${MODULE_ID}/templates/${path.join('/')}.hbs`\r\n}\r\n\r\nexport function localeCompare(a, b) {\r\n    return a.localeCompare(b, game.i18n.lang)\r\n}\r\n\r\nexport function socketOn(callback) {\r\n    game.socket.on(`module.${MODULE_ID}`, callback)\r\n}\r\n\r\nexport function socketOff(callback) {\r\n    game.socket.off(`module.${MODULE_ID}`, callback)\r\n}\r\n\r\nexport function socketEmit(packet) {\r\n    game.socket.emit(`module.${MODULE_ID}`, packet)\r\n}\r\n\r\nexport function isActiveGM() {\r\n    return game.user === game.users.activeGM\r\n}\r\n\r\nexport function registerUpstreamHook(hook, fn) {\r\n    const id = Hooks.on(hook, fn)\r\n    const index = Hooks.events[hook].findIndex(x => x.id === id)\r\n\r\n    if (index !== 0) {\r\n        const [hooked] = Hooks.events[hook].splice(index, 1)\r\n        Hooks.events[hook].unshift(hooked)\r\n    }\r\n\r\n    return id\r\n}\r\n\r\nexport function isGMOnline() {\r\n    return game.users.some(user => user.active && user.isGM)\r\n}\r\n\r\nexport function chatUUID(uuid, label, fake = false) {\r\n    if (fake) {\r\n        return `<span style=\"background: #DDD; padding: 1px 4px; border: 1px solid var(--color-border-dark-tertiary);\r\nborder-radius: 2px; white-space: nowrap; word-break: break-all;\">${label}</span>`\r\n    } else {\r\n        return `@UUID[${uuid}]{${label}}`\r\n    }\r\n}\r\n", "import { getSetting, info, registerWrapper } from '../module'\r\n\r\nconst PREPARE_WEAPON_DATA = 'CONFIG.PF2E.Item.documentClasses.weapon.prototype.prepareBaseData'\r\nconst PREPARE_WEAPON_DERIVED_DATA = 'CONFIG.PF2E.Item.documentClasses.weapon.prototype.prepareDerivedData'\r\nconst PREPARE_ARMOR_DATA = 'CONFIG.PF2E.Item.documentClasses.armor.prototype.prepareBaseData'\r\nconst PREPARE_ARMOR_DERIVED_DATA = 'CONFIG.PF2E.Item.documentClasses.armor.prototype.prepareDerivedData'\r\n\r\nconst WEAPON_EXCLUDES = ['Compendium.pf2e.equipment-srd.Item.ZhxxqYpVdVx0jSMm']\r\n\r\nexport function registerArp() {\r\n    return {\r\n        settings: [\r\n            {\r\n                name: 'arp',\r\n                type: Boolean,\r\n                default: false,\r\n                requiresReload: true,\r\n            },\r\n        ],\r\n        conflicts: ['pf2e-arp'],\r\n        init: () => {\r\n            if (!getSetting('arp')) return\r\n            registerWrapper(PREPARE_WEAPON_DATA, onPrepareWeaponData, 'WRAPPER')\r\n            registerWrapper(PREPARE_WEAPON_DERIVED_DATA, onPrepareWeaponDerivedData, 'WRAPPER')\r\n            registerWrapper(PREPARE_ARMOR_DATA, onPrepareArmorData, 'WRAPPER')\r\n            registerWrapper(PREPARE_ARMOR_DERIVED_DATA, onPrepareArmorDerivedData, 'WRAPPER')\r\n        },\r\n        ready: isGM => {\r\n            if (isGM && getSetting('arp') && game.settings.get('pf2e', 'automaticBonusVariant') !== 'noABP') {\r\n                game.settings.set('pf2e', 'automaticBonusVariant', 'noABP')\r\n                info('arp.forceVariant')\r\n            }\r\n        },\r\n    }\r\n}\r\n\r\nfunction isValidActor(actor, isCharacter = false) {\r\n    return actor && !actor.getFlag('pf2e', 'disableABP') && (!isCharacter || actor.isOfType('character'))\r\n}\r\n\r\nfunction isValidWeapon(weapon) {\r\n    const traits = weapon._source.system.traits.value\r\n    return !traits.includes('alchemical') && !traits.includes('bomb') && !WEAPON_EXCLUDES.includes(weapon.sourceId)\r\n}\r\n\r\nfunction onPrepareWeaponData(wrapped) {\r\n    const actor = this.actor\r\n    if (!isValidActor(actor, true) || !isValidWeapon(this)) return wrapped()\r\n\r\n    const level = actor.level\r\n\r\n    const traits = this._source.system.traits.value\r\n    if (traits.includes('alchemical') && traits.includes('bomb')) return wrapped()\r\n\r\n    this.system.potencyRune.value = level < 2 ? null : level < 10 ? 1 : level < 16 ? 2 : 3\r\n    this.system.strikingRune.value = level < 4 ? null : level < 12 ? 'striking' : level < 19 ? 'greaterStriking' : 'majorStriking'\r\n\r\n    wrapped()\r\n}\r\n\r\nconst WEAPON_POTENCY_PRICE = {\r\n    1: 35,\r\n    2: 935,\r\n    3: 8935,\r\n    4: 8935,\r\n}\r\nconst WEAPON_STRIKING_PRICE = {\r\n    striking: 65,\r\n    greaterStriking: 1065,\r\n    majorStriking: 31065,\r\n}\r\nfunction onPrepareWeaponDerivedData(wrapped) {\r\n    wrapped()\r\n\r\n    if (!isValidActor(this.actor) || this.isSpecific || !isValidWeapon(this)) return\r\n\r\n    let gp = this.price.value.goldValue\r\n\r\n    const potency = this.system.potencyRune.value\r\n    if (potency) gp -= WEAPON_POTENCY_PRICE[potency]\r\n\r\n    const striking = this.system.strikingRune.value\r\n    if (striking) gp -= WEAPON_STRIKING_PRICE[striking]\r\n\r\n    if ((potency || striking) && !this.system.runes.property.length)\r\n        gp += new game.pf2e.Coins(this._source.system.price.value).goldValue\r\n\r\n    this.system.price.value = new game.pf2e.Coins({ gp })\r\n}\r\n\r\nfunction isValidArmor(armor) {\r\n    return !armor.isShield\r\n}\r\n\r\nfunction onPrepareArmorData(wrapped) {\r\n    const actor = this.actor\r\n    if (!isValidActor(actor, true) || !isValidArmor(this)) return wrapped()\r\n\r\n    const level = actor.level\r\n\r\n    this.system.potencyRune.value = level < 5 ? null : level < 11 ? 1 : level < 18 ? 2 : 3\r\n    this.system.resiliencyRune.value =\r\n        level < 8 ? null : level < 14 ? 'resilient' : level < 20 ? 'greaterResilient' : 'majorResilient'\r\n\r\n    wrapped()\r\n}\r\n\r\nconst ARMOR_POTENCY_PRICE = {\r\n    1: 160,\r\n    2: 1060,\r\n    3: 20560,\r\n    4: 20560,\r\n}\r\nconst ARMOR_RESILIENCY_PRICE = {\r\n    resilient: 340,\r\n    greaterResilient: 3440,\r\n    majorResilient: 49440,\r\n}\r\nfunction onPrepareArmorDerivedData(wrapped) {\r\n    wrapped()\r\n\r\n    if (!isValidActor(this.actor) || this.isSpecific || !isValidArmor(this)) return\r\n\r\n    let gp = this.price.value.goldValue\r\n\r\n    const potency = this.system.potencyRune.value\r\n    if (potency) gp -= ARMOR_POTENCY_PRICE[potency]\r\n\r\n    const resiliency = this.system.resiliencyRune.value\r\n    if (resiliency) gp -= ARMOR_RESILIENCY_PRICE[resiliency]\r\n\r\n    if ((potency || resiliency) && !this.system.runes.property.length)\r\n        gp += new game.pf2e.Coins(this._source.system.price.value).goldValue\r\n\r\n    this.system.price.value = new game.pf2e.Coins({ gp })\r\n}\r\n", "import { getSetting } from '../../module'\r\n\r\nexport function createHook(event, listener, callback = () => {}) {\r\n    let HOOK = null\r\n\r\n    return function (value, otherSettings = []) {\r\n        if (typeof otherSettings === 'string') otherSettings = [otherSettings]\r\n\r\n        value ||= otherSettings.some(s => getSetting(s))\r\n\r\n        if (value && !HOOK) {\r\n            HOOK = Hooks.on(event, listener)\r\n        } else if (!value && HOOK) {\r\n            Hooks.off(event, HOOK)\r\n            HOOK = null\r\n        }\r\n\r\n        callback(value)\r\n    }\r\n}\r\n\r\nexport function createChoicesHook(event, listener, callback = () => {}) {\r\n    let HOOK = null\r\n\r\n    return function (value) {\r\n        if (value === 'disabled' && HOOK) {\r\n            Hooks.off(event, HOOK)\r\n            HOOK = null\r\n        } else if (value !== 'disabled' && !HOOK) {\r\n            HOOK = Hooks.on(event, listener)\r\n        }\r\n\r\n        callback(value)\r\n    }\r\n}\r\n", "import { getSetting, localize } from '../module'\r\nimport { createHook } from './shared/hook'\r\n\r\nconst setHook = createHook('renderEffectsPanel', renderEffectsPanel, refreshEffectsPanel)\r\n\r\nexport function registerEffectsPanelHelper() {\r\n    return {\r\n        settings: [\r\n            {\r\n                name: 'effect-remove',\r\n                type: Boolean,\r\n                default: false,\r\n                scope: 'client',\r\n                onChange: value => setHook(value, 'condition-sheet'),\r\n            },\r\n            {\r\n                name: 'condition-sheet',\r\n                type: Boolean,\r\n                default: false,\r\n                scope: 'client',\r\n                onChange: value => setHook(value, 'effect-remove'),\r\n            },\r\n        ],\r\n        conflicts: ['pf2e-effect-description'],\r\n        init: () => {\r\n            setHook(false, ['effect-remove', 'condition-sheet'])\r\n        },\r\n    }\r\n}\r\n\r\nfunction refreshEffectsPanel() {\r\n    game.pf2e.effectPanel?.render()\r\n}\r\n\r\nfunction renderEffectsPanel(panel, html) {\r\n    const removeRow = `<div>${localize('effects.remove')}</div>`\r\n    const editIcon = `<a data-action=\"edit\" data-tooltip=\"Edit Item\"><i class=\"fa-solid fa-fw fa-pencil\"></i></a>`\r\n\r\n    const effectPanels = html.find('.effect-item[data-item-id]').toArray()\r\n    for (const effectPanel of effectPanels) {\r\n        const id = effectPanel.dataset.itemId\r\n        const effect = panel.actor?.items.get(id)\r\n        if (!effect) continue\r\n\r\n        if (getSetting('effect-remove') && !effect.isLocked && effect.badge && effect.badge.type === 'counter') {\r\n            effectPanel.querySelector('.effect-info .instructions').insertAdjacentHTML('beforeend', removeRow)\r\n            effectPanel.querySelector('.icon').addEventListener('contextmenu', event => onRemoveEffect(event, panel), true)\r\n        }\r\n\r\n        if (getSetting('condition-sheet') && effect.isOfType('condition')) {\r\n            const h1 = effectPanel.querySelector('.effect-info > h1')\r\n            h1.insertAdjacentHTML('beforeend', editIcon)\r\n            h1.querySelector('[data-action=\"edit\"]').addEventListener('click', event => onConditionSheet(event, panel))\r\n        }\r\n    }\r\n}\r\n\r\nfunction onConditionSheet(event, panel) {\r\n    const effect = getEffect(event, panel)\r\n    if (!effect?.isOfType('condition')) return\r\n    event.preventDefault()\r\n    effect.sheet.render(true)\r\n}\r\n\r\nfunction onRemoveEffect(event, panel) {\r\n    if (!event.shiftKey) return\r\n\r\n    const effect = getEffect(event, panel)\r\n    if (!effect || effect.isLocked || !effect.badge || effect.badge.type !== 'counter') return\r\n\r\n    event.preventDefault()\r\n    event.stopPropagation()\r\n    event.stopImmediatePropagation()\r\n\r\n    effect.delete()\r\n}\r\n\r\nfunction getEffect(event, panel) {\r\n    const target = event.currentTarget\r\n    const effect = target.closest('.effect-item[data-item-id]')\r\n    const id = effect.dataset.itemId\r\n    return panel.actor?.items.get(id)\r\n}\r\n", "export class MoveLootPopup extends FormApplication {\r\n    constructor(object, options, callback) {\r\n        super(object, options)\r\n        this.onSubmitCallback = callback\r\n    }\r\n\r\n    async getData() {\r\n        const [prompt, buttonLabel] = this.options.isPurchase\r\n            ? ['PF2E.loot.PurchaseLootMessage', 'PF2E.loot.PurchaseLoot']\r\n            : ['PF2E.loot.MoveLootMessage', 'PF2E.loot.MoveLoot']\r\n\r\n        return {\r\n            ...(await super.getData()),\r\n            maxQuantity: this.options.maxQuantity,\r\n            newStack: this.options.newStack,\r\n            lockStack: this.options.lockStack,\r\n            prompt,\r\n            buttonLabel,\r\n        }\r\n    }\r\n\r\n    static get defaultOptions() {\r\n        return {\r\n            ...super.defaultOptions,\r\n            id: 'MoveLootPopup',\r\n            classes: [],\r\n            title: game.i18n.localize('PF2E.loot.MoveLootPopupTitle'),\r\n            template: 'systems/pf2e/templates/popups/loot/move-loot-popup.hbs',\r\n            width: 'auto',\r\n            maxQuantity: 1,\r\n            newStack: false,\r\n            lockStack: false,\r\n            isPurchase: false,\r\n        }\r\n    }\r\n\r\n    async _updateObject(_event, formData) {\r\n        this.onSubmitCallback(formData.quantity, formData.newStack)\r\n    }\r\n}\r\n", "import { MoveLootPopup } from '../apps/giveth/popup'\r\nimport {\r\n    chatUUID,\r\n    getSetting,\r\n    isActiveGM,\r\n    isGMOnline,\r\n    localize,\r\n    registerUpstreamHook,\r\n    socketEmit,\r\n    socketOff,\r\n    socketOn,\r\n    warn,\r\n} from '../module'\r\n\r\nlet enabled = false\r\nlet CANVAS_HOOK = null\r\n\r\nexport function registerGiveth() {\r\n    return {\r\n        settings: [\r\n            {\r\n                name: 'giveth',\r\n                type: String,\r\n                default: 'disabled',\r\n                choices: ['disabled', 'enabled', 'no-message'],\r\n                onChange: setup,\r\n            },\r\n        ],\r\n        conflicts: ['pf2e-giveth'],\r\n        ready: isGM => {\r\n            if (getSetting('giveth') !== 'disabled') setup(true)\r\n        },\r\n    }\r\n}\r\n\r\nfunction setup(value) {\r\n    const isGM = game.user.isGM\r\n\r\n    if (value === 'disabled' && enabled) {\r\n        if (isGM) socketOff(onSocket)\r\n        else if (CANVAS_HOOK) {\r\n            Hooks.off('dropCanvasData', CANVAS_HOOK)\r\n            CANVAS_HOOK = null\r\n        }\r\n        enabled = false\r\n    } else if (value !== 'disabled' && !enabled) {\r\n        if (isGM) socketOn(onSocket)\r\n        else if (!CANVAS_HOOK) CANVAS_HOOK = registerUpstreamHook('dropCanvasData', onDropCanvasData)\r\n        enabled = true\r\n    }\r\n}\r\n\r\nfunction onSocket(packet) {\r\n    if (!isActiveGM()) return\r\n    if (packet.type === 'giveth-condition') takethCondition(packet)\r\n    else if (packet.type === 'giveth-effect') takethEffect(packet)\r\n    else takethPhysical(packet)\r\n}\r\n\r\nfunction onDropCanvasData(canvas, data) {\r\n    if (!isGMOnline()) return true\r\n\r\n    const details = getDetailsFromData(data)\r\n    if (!details) return true\r\n\r\n    const target = canvas.tokens.placeables\r\n        .slice()\r\n        .filter(token => {\r\n            if (!token.document.actorLink) return false\r\n            const target = token.actor\r\n            if (!isValidActor(target, data.actorId) || target.isOwner) return false\r\n            const maximumX = token.x + (token.hitArea?.right ?? 0)\r\n            const maximumY = token.y + (token.hitArea?.bottom ?? 0)\r\n            return data.x >= token.x && data.y >= token.y && data.x <= maximumX && data.y <= maximumY\r\n        })\r\n        .sort((a, b) => b.document.sort - a.document.sort)\r\n        .at(0)?.actor\r\n\r\n    if (!target) return true\r\n\r\n    giveth(details.actor, target, details.item, details.value)\r\n    return false\r\n}\r\n\r\nfunction giveth(origin, target, item, value) {\r\n    const ownerId = origin.id\r\n    const targetId = target.id\r\n    const isIndex = !(item instanceof Item)\r\n\r\n    if (!isIndex && item.isOfType('physical')) {\r\n        const qty = item.quantity\r\n        if (qty < 1) return warn('giveth.notification.zero')\r\n\r\n        if (qty === 1) return sendPhysicalRequest(ownerId, targetId, item.id, 1, false)\r\n\r\n        new MoveLootPopup(origin, { maxQuantity: qty, lockStack: false, isPurchase: false }, (qty, stack) => {\r\n            sendPhysicalRequest(ownerId, targetId, item.id, qty, stack)\r\n        }).render(true)\r\n    } else {\r\n        const uuid = isIndex ? `Compendium.${item.pack}.${item._id}` : item.uuid\r\n        if (item.type === 'condition') {\r\n            socketEmit({\r\n                type: 'giveth-condition',\r\n                targetId,\r\n                value: value ?? 1,\r\n                uuid,\r\n            })\r\n        } else {\r\n            socketEmit({\r\n                type: 'giveth-effect',\r\n                targetId,\r\n                uuid,\r\n            })\r\n        }\r\n    }\r\n}\r\n\r\nfunction sendPhysicalRequest(ownerId, targetId, itemId, qty, stack) {\r\n    socketEmit({\r\n        type: 'giveth-physical',\r\n        ownerId,\r\n        targetId,\r\n        itemId,\r\n        qty,\r\n        stack,\r\n    })\r\n}\r\n\r\nfunction isValidActor(actor, id) {\r\n    if (!actor || (id && actor.id === id)) return false\r\n    return actor.hasPlayerOwner && !actor.isToken && actor.isOfType('character', 'npc', 'vehicle')\r\n}\r\n\r\nfunction getDetailsFromData(data) {\r\n    if (data.tokenId || data.type !== 'Item' || !data.uuid) return\r\n\r\n    const item = fromUuidSync(data.uuid)\r\n    if (!item) return\r\n\r\n    let actor = item.actor\r\n    if (!actor) {\r\n        const actorUUID = data.context?.origin.actor\r\n        actor = actorUUID ? fromUuidSync(actorUUID) : null\r\n    }\r\n\r\n    if (!isValidActor(actor) || !actor.isOwner) return\r\n\r\n    const isIndex = !(item instanceof Item)\r\n    if (isIndex && item.pack && ['effect', 'condition'].includes(item.type)) return { actor, item, value: data.value }\r\n    if (!isIndex && item.isOfType('physical', 'effect')) return { actor, item, value: data.value }\r\n}\r\n\r\nasync function takethCondition({ targetId, uuid, value }) {\r\n    const target = game.actors.get(targetId)\r\n    if (!target) return\r\n\r\n    const item = await fromUuid(uuid)\r\n    if (!item) return\r\n\r\n    target.increaseCondition(item.slug, { min: value })\r\n}\r\n\r\nasync function takethEffect({ targetId, uuid }) {\r\n    const target = game.actors.get(targetId)\r\n    if (!target) return\r\n\r\n    const item = await fromUuid(uuid)\r\n    if (!item) return\r\n\r\n    const source = item.clone({ 'system.tokenIcon.show': true, 'system.unidentified': false }).toObject()\r\n    target.createEmbeddedDocuments('Item', [source])\r\n}\r\n\r\nasync function takethPhysical({ itemId, ownerId, qty, stack, targetId }) {\r\n    const owner = game.actors.get(ownerId)\r\n    const target = game.actors.get(targetId)\r\n    if (!owner || !target) return\r\n\r\n    const item = owner.items.get(itemId)\r\n    if (!item) return\r\n\r\n    qty = Math.min(qty, item.quantity)\r\n    const newQty = item.quantity - qty\r\n\r\n    const source = item.toObject()\r\n    source.system.quantity = qty\r\n    source.system.equipped.carryType = 'worn'\r\n    if (item.isOfType('physical') && 'invested' in source.system.equipped) {\r\n        source.system.equipped.invested = item.traits.has('invested') ? false : null\r\n    }\r\n\r\n    const newItem = await target.addToInventory(source, undefined, stack)\r\n    if (!newItem) return\r\n\r\n    if (newQty < 1) item.delete()\r\n    else item.update({ 'system.quantity': newQty })\r\n\r\n    if (getSetting('giveth') === 'no-message') return\r\n\r\n    let content = chatUUID(newItem.uuid, newItem.name, !newItem.isIdentified)\r\n    if (qty > 1) content += ` x${qty}`\r\n\r\n    ChatMessage.create({\r\n        flavor: `<h4 class=\"action\">${localize('giveth.giveth', { target: target.name })}</h4>`,\r\n        content,\r\n        speaker: ChatMessage.getSpeaker({ actor: owner }),\r\n    })\r\n}\r\n", "import { getFlag, setFlag, subLocalize, templatePath } from '../../module'\r\n\r\nconst localize = subLocalize('knowledges.editLore')\r\n\r\nexport class EditLores extends FormApplication {\r\n    get actor() {\r\n        return this.object\r\n    }\r\n\r\n    get id() {\r\n        return `npc-edit-lores-${this.actor.id}`\r\n    }\r\n\r\n    get title() {\r\n        return localize('title', this.actor)\r\n    }\r\n\r\n    get template() {\r\n        return templatePath('knowledges/lores')\r\n    }\r\n\r\n    getData(options) {\r\n        const actor = this.actor\r\n\r\n        return mergeObject(super.getData(options), {\r\n            unspecified: getFlag(actor, 'unspecified') ?? '',\r\n            specific: getFlag(actor, 'specific') ?? '',\r\n            i18n: localize,\r\n        })\r\n    }\r\n\r\n    async _updateObject(event, { unspecified, specific }) {\r\n        const actor = this.object\r\n        setFlag(actor, 'unspecified', unspecified.trim())\r\n        setFlag(actor, 'specific', specific.trim())\r\n    }\r\n\r\n    activateListeners(html) {\r\n        html.find('button.cancel').on('click', this.#onCancel.bind(this))\r\n    }\r\n\r\n    #onCancel(event) {\r\n        event.preventDefault()\r\n        this.close()\r\n    }\r\n}\r\n", "import { EditLores } from '../apps/knowledges/lores'\r\nimport { getFlag, getSetting } from '../module'\r\nimport { createHook } from './shared/hook'\r\n\r\nconst setHook = createHook('renderNPCSheetPF2e', renderNPCSheetPF2e)\r\n\r\nexport function registerKnowledges() {\r\n    return {\r\n        settings: [\r\n            {\r\n                name: 'knowledges',\r\n                type: Boolean,\r\n                default: false,\r\n                onChange: setHook,\r\n            },\r\n        ],\r\n        conflicts: ['pf2e-npc-knowledges'],\r\n        ready: isGM => {\r\n            if (isGM && getSetting('knowledges')) setHook(true)\r\n        },\r\n    }\r\n}\r\n\r\nfunction renderNPCSheetPF2e(sheet, $html) {\r\n    const actor = sheet.actor\r\n\r\n    replaceLores(actor, $html)\r\n    addEditButton($html)\r\n    addEvents(actor, $html)\r\n}\r\n\r\nfunction knowledgeSelector(html, section, selector) {\r\n    return html.find(\r\n        `[data-tab=\"main\"] .recall-knowledge ${section === 'header' ? '.section-header' : '.section-body'} ${selector}`\r\n    )\r\n}\r\n\r\nfunction editLores(actor) {\r\n    new EditLores(actor).render(true)\r\n}\r\n\r\nfunction replaceLores(actor, html) {\r\n    const unspecifics = getFlag(actor, 'unspecified')\r\n    const specifics = getFlag(actor, 'specific')\r\n    if (!unspecifics && !specifics) return\r\n\r\n    const lores = actor.identificationDCs.lore\r\n    const body = knowledgeSelector(html, 'body', '')\r\n    body.find('.identification-skills').last().remove()\r\n\r\n    function tag(skills, dc, adjustment) {\r\n        const content = game.i18n.format('PF2E.Actor.NPC.Identification.Skills.Label', { skills, dc, adjustment })\r\n        return `<div class=\"tag-legacy identification-skills tooltipstered\">${content}</div>`\r\n    }\r\n\r\n    function addTags(lores, { dc, start }) {\r\n        const tags = lores\r\n            .split(',')\r\n            .filter(lore => lore.trim())\r\n            .map(lore => tag(lore, dc, start))\r\n            .join('')\r\n        body.append(tags)\r\n    }\r\n\r\n    addTags(unspecifics || 'Unspecific', lores[0])\r\n    addTags(specifics || 'Specific', lores[1])\r\n}\r\n\r\nfunction addEvents(actor, html) {\r\n    const edit = knowledgeSelector(html, 'header', 'button.edit')\r\n    edit.on('click', () => editLores(actor))\r\n}\r\n\r\nfunction addEditButton(html) {\r\n    const attempts = knowledgeSelector(html, 'header', 'button')\r\n    const edit = '<button type=\"button\" class=\"breakdown edit\">Edit</button>'\r\n    attempts.before(edit)\r\n}\r\n", "import { subLocalize, templatePath } from '../../module'\r\n\r\nconst localize = subLocalize('merge.multi')\r\n\r\nexport class MultiCast extends Application {\r\n    constructor(spell, options) {\r\n        super(options)\r\n        this._spell = spell\r\n    }\r\n\r\n    get spell() {\r\n        return this._spell\r\n    }\r\n\r\n    get title() {\r\n        return localize('title', this.spell)\r\n    }\r\n\r\n    get template() {\r\n        return templatePath('merge/multi')\r\n    }\r\n\r\n    getData(options) {\r\n        return mergeObject(super.getData(options), {\r\n            i18n: localize,\r\n        })\r\n    }\r\n\r\n    activateListeners(html) {\r\n        html.find('[data-action=cast]').on('click', this.#onCast.bind(this))\r\n        html.find('[data-action=cancel]').on('click', this.#onCancel.bind(this))\r\n    }\r\n\r\n    async #onCast(event) {\r\n        event.preventDefault()\r\n\r\n        const nb = this.element.find('[name=multi]').val()\r\n        if (nb < 1) {\r\n            localize.error('zero')\r\n            this.close()\r\n            return\r\n        }\r\n\r\n        const spell = this.spell\r\n        const damages = deepClone(spell._source.system.damage.value)\r\n        const heightening = deepClone(spell._source.system.heightening) ?? {}\r\n\r\n        for (const [id, damage] of Object.entries(damages)) {\r\n            for (let i = 0; i < nb - 1; i++) {\r\n                const newId = randomID()\r\n\r\n                damages[newId] = damage\r\n\r\n                if (heightening.type === 'interval') {\r\n                    const damage = heightening.damage[id]\r\n                    if (damage) heightening.damage[newId] = damage\r\n                } else if (heightening.type === 'fixed') {\r\n                    for (const [level, data] of Object.entries(heightening.levels)) {\r\n                        const damage = data.damage.value[id]\r\n                        if (damage) heightening.levels[level].damage.value[newId] = damage\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        const newSpell = spell.clone({ 'system.damage.value': damages, 'system.heightening': heightening })\r\n        newSpell.rollDamage(event)\r\n\r\n        this.close()\r\n    }\r\n\r\n    #onCancel(event) {\r\n        event.preventDefault()\r\n        this.close()\r\n    }\r\n}\r\n", "import { MultiCast } from '../apps/merge/multi'\r\nimport { MODULE_ID, getFlag, getSetting, localize, templatePath, warn } from '../module'\r\nimport { createHook } from './shared/hook'\r\n\r\nconst FLAVOR_TAGS = /<div class=\"tags\"><span class=\"tag\".+?<\\/div>/gm\r\nconst FLAVOR_MODIFIERS = /<span class=\"tag tag_transparent\">(.+?)<\\/span>/gm\r\nconst FORMULA_STRIP = /(\\[[\\w,]+\\])/\r\n\r\nconst setHook = createHook('renderChatMessage', renderChatMessage, updateMessages)\r\n\r\nexport function registerMerge() {\r\n    return {\r\n        settings: [\r\n            {\r\n                name: 'merge-damage',\r\n                type: Boolean,\r\n                default: false,\r\n                scope: 'client',\r\n                onChange: value => setHook(value, 'multi-cast'),\r\n            },\r\n            {\r\n                name: 'multi-cast',\r\n                type: Boolean,\r\n                default: false,\r\n                scope: 'client',\r\n                onChange: value => setHook(value, 'merge-damage'),\r\n            },\r\n        ],\r\n        init: isGm => {\r\n            setHook(false, ['multi-cast', 'merge-damage'])\r\n        },\r\n    }\r\n}\r\n\r\nfunction updateMessages() {\r\n    const chat = ui.chat?.element\r\n    if (!chat) return\r\n\r\n    for (const message of chatMessages(10)) {\r\n        const html = chat.find(`[data-message-id=${message.id}]`)\r\n        if (!html.length) continue\r\n\r\n        html.find('[data-action=multi-cast]').remove()\r\n        html.find('[data-action=merge-damage]').remove()\r\n\r\n        renderChatMessage(message, html)\r\n    }\r\n}\r\n\r\nfunction renderChatMessage(message, html) {\r\n    if (!game.user.isGM && !message.isAuthor) return\r\n    if (getSetting('merge-damage') && isDamageRoll(message)) renderDamage(message, html)\r\n    else if (getSetting('multi-cast') && message.getFlag('pf2e', 'origin.type') === 'spell') renderSpell(message, html)\r\n}\r\n\r\nfunction renderSpell(message, html) {\r\n    const uuid = message.getFlag('pf2e', 'origin.uuid')\r\n    if (!uuid) return\r\n\r\n    const spellBtn = html.find('.message-content .chat-card .owner-buttons .spell-button')\r\n\r\n    spellBtn\r\n        .find('[data-action=spell-damage]')\r\n        .after(`<button data-action=\"multi-cast\">${localize('merge.spell.button')}</button>`)\r\n\r\n    spellBtn.find('[data-action=multi-cast]').on('click', async event => {\r\n        const spell = await fromUuid(uuid)\r\n        if (spell) new MultiCast(spell).render(true)\r\n    })\r\n}\r\n\r\nfunction renderDamage(message, html) {\r\n    const uuid = getMessageUuid(message)\r\n    if (!uuid) return\r\n\r\n    const tooltip = localize('merge.damage.tooltip')\r\n    const button = `<span style=\"position: absolute; right: 0px; bottom: 1px;\">\r\n    <button data-action=\"merge-damage\" title=\"${tooltip}\" style=\"width: 22px; height: 22px; font-size: 10px; line-height: 1px;\">\r\n        <i class=\"fa-duotone fa-merge\"></i>\r\n    </button>\r\n</span>`\r\n\r\n    const originTarget = getMessageTarget(message)\r\n\r\n    html.find('.dice-result .dice-total').append(button)\r\n    html.find('[data-action=merge-damage]').on('click', event => {\r\n        event.stopPropagation()\r\n\r\n        for (const otherMessage of chatMessages(5, message)) {\r\n            if (\r\n                getMessageUuid(otherMessage) !== uuid ||\r\n                getMessageTarget(otherMessage) !== originTarget ||\r\n                !isDamageRoll(otherMessage)\r\n            )\r\n                continue\r\n\r\n            mergeDamages(event, message, otherMessage)\r\n            return\r\n        }\r\n\r\n        warn('merge.damage.none')\r\n    })\r\n}\r\n\r\nasync function mergeDamages(event, origin, other) {\r\n    const name = getItemName(origin, other)\r\n    const tags = getTags(origin, other)\r\n    const notes = getMessageNotes(other)\r\n    const modifiers = getMessageModifiers(other)\r\n\r\n    const target = getMessageTarget(origin)\r\n    const uuid = getMessageUuid(origin)\r\n\r\n    for (const note of getMessageNotes(origin)) {\r\n        if (!notes.includes(note)) notes.push(note)\r\n    }\r\n\r\n    for (const modifier of getMessageModifiers(origin)) {\r\n        if (!modifiers.includes(modifier)) modifiers.push(modifier)\r\n    }\r\n\r\n    const originRolls = getMessageRolls(origin)\r\n    const otherRolls = getMessageRolls(other)\r\n\r\n    const grouped = []\r\n\r\n    function findGroup(options) {\r\n        return grouped.find(({ options: { flavor, critRule } }) => flavor === options.flavor && critRule === options.critRule)\r\n    }\r\n\r\n    for (const roll of [].concat(otherRolls, originRolls)) {\r\n        const { options, total, terms } = roll\r\n        const term = terms[0]\r\n        const formula = roll.formula.replace(FORMULA_STRIP, '')\r\n        const group = findGroup(options)\r\n\r\n        if (group) {\r\n            group.terms.push(term)\r\n            group.total += total\r\n            group.formulas.push(formula)\r\n        } else {\r\n            grouped.push({\r\n                options,\r\n                formulas: [formula],\r\n                total,\r\n                terms: [term],\r\n            })\r\n        }\r\n    }\r\n\r\n    for (const group of grouped) {\r\n        group.formula = `(${group.formulas.join(' + ')})[${group.options.flavor}]`\r\n        group.term = group.terms.length < 2 ? group.terms[0] : createTermGroup(group.terms)\r\n    }\r\n\r\n    const roll = {\r\n        class: 'DamageRoll',\r\n        options: {},\r\n        dice: [],\r\n        formula: `{${grouped.map(({ formula }) => formula).join(', ')}}`,\r\n        total: grouped.reduce((acc, { total }) => acc + total, 0),\r\n        evaluated: true,\r\n        terms: [\r\n            {\r\n                class: 'InstancePool',\r\n                options: {},\r\n                evaluated: true,\r\n                terms: grouped.map(({ formula }) => formula),\r\n                modifiers: [],\r\n                rolls: grouped.map(({ options, formula, total, term }) => ({\r\n                    class: 'DamageInstance',\r\n                    options,\r\n                    dice: [],\r\n                    formula,\r\n                    total,\r\n                    terms: [term],\r\n                    evaluated: true,\r\n                })),\r\n                results: grouped.map(({ total }) => ({ result: total, active: true })),\r\n            },\r\n        ],\r\n    }\r\n\r\n    ui.chat.element.find(`[data-message-id=${origin.id}], [data-message-id=${other.id}]`).remove()\r\n    await ChatMessage.deleteDocuments([origin.id, other.id])\r\n\r\n    const flavor = await renderTemplate(templatePath('merge/merged'), {\r\n        header: localize('merge.merged.header', { name }),\r\n        tags,\r\n        notes,\r\n        modifiers,\r\n    })\r\n\r\n    await CONFIG.ChatMessage.documentClass.create({\r\n        flavor,\r\n        type: CONST.CHAT_MESSAGE_TYPES.ROLL,\r\n        speaker: origin.speaker,\r\n        flags: {\r\n            [MODULE_ID]: {\r\n                name,\r\n                tags,\r\n                notes,\r\n                modifiers,\r\n                uuid,\r\n                type: 'damage-roll',\r\n                target,\r\n                merged: true,\r\n            },\r\n        },\r\n        rolls: [roll],\r\n    })\r\n}\r\n\r\nfunction createTermGroup(terms) {\r\n    const options = deepClone(terms[0].options)\r\n    terms.map(term => ((term.options = {}), term))\r\n\r\n    return {\r\n        class: 'Grouping',\r\n        options,\r\n        evaluated: true,\r\n        term: {\r\n            class: 'ArithmeticExpression',\r\n            options: {},\r\n            evaluated: true,\r\n            operator: '+',\r\n            operands: [terms.shift(), terms.length > 1 ? createTermGroup(terms) : terms[0]],\r\n        },\r\n    }\r\n}\r\n\r\nfunction* chatMessages(nb, fromMessage) {\r\n    const messages = game.messages.contents\r\n    const start = (fromMessage ? messages.findLastIndex(m => m === fromMessage) : messages.length) - 1\r\n\r\n    for (let i = start; i >= start - nb; i--) {\r\n        const message = messages[i]\r\n        if (!message) return\r\n        yield message\r\n    }\r\n}\r\n\r\nfunction getMessageRolls(message) {\r\n    return getFlag(message, 'rolls') ?? JSON.parse(message._source.rolls[0]).terms[0].rolls\r\n}\r\n\r\nfunction getMessageUuid(message) {\r\n    return getMessageFlag(message, 'origin.uuid', 'uuid')\r\n}\r\n\r\nfunction isDamageRoll(message) {\r\n    return getMessageFlag(message, 'context.type', 'type') === 'damage-roll'\r\n}\r\n\r\nfunction getMessageTarget(message) {\r\n    return getMessageFlag(message, 'context.target.token', 'target')\r\n}\r\n\r\nfunction getItemName(m1, m2) {\r\n    return getFlag(m1, 'name') ?? getFlag(m2, 'name') ?? m1.getFlag('pf2e', 'strike.name') ?? m1.item.name\r\n}\r\n\r\nfunction getTags(m1, m2) {\r\n    return getFlag(m1, 'tags') ?? getFlag(m2, 'tags') ?? m1.flavor.match(FLAVOR_TAGS)?.[0] ?? ''\r\n}\r\n\r\nfunction getMessageNotes(message) {\r\n    return (\r\n        getFlag(message, 'notes') ??\r\n        message\r\n            .getFlag('pf2e', 'context.notes')\r\n            .map(({ title, text }) => `<strong>${game.i18n.localize(title)}</strong> ${game.i18n.localize(text)}`)\r\n    )\r\n}\r\n\r\nfunction getMessageModifiers(message) {\r\n    let modifiers = getFlag(message, 'modifiers')\r\n    if (modifiers) return modifiers\r\n\r\n    modifiers = []\r\n\r\n    let match\r\n    while ((match = FLAVOR_MODIFIERS.exec(message.flavor))) {\r\n        modifiers.push(match[1])\r\n    }\r\n\r\n    return modifiers\r\n}\r\n\r\nfunction getMessageFlag(message, systemFlag, moduleFlag) {\r\n    return message.getFlag('pf2e', systemFlag) ?? getFlag(message, moduleFlag)\r\n}\r\n", "import { getSetting, registerWrapper } from '../module'\r\n\r\nconst ACTOR_PREPARE_EMBEDDED_DOCUMENTS = 'CONFIG.Actor.documentClass.prototype.prepareEmbeddedDocuments'\r\n\r\nexport function registerNobulk() {\r\n    return {\r\n        settings: [\r\n            {\r\n                name: 'nobulk',\r\n                type: Boolean,\r\n                default: false,\r\n                requiresReload: true,\r\n            },\r\n        ],\r\n        init: () => {\r\n            if (!getSetting('nobulk')) return\r\n            registerWrapper(ACTOR_PREPARE_EMBEDDED_DOCUMENTS, actorPrepareEmbeddedDocuments, 'WRAPPER')\r\n        },\r\n    }\r\n}\r\n\r\nfunction actorPrepareEmbeddedDocuments(wrapped, ...args) {\r\n    wrapped(...args)\r\n\r\n    const actor = this\r\n    const InventoryBulk = actor.inventory.bulk.constructor\r\n\r\n    Object.defineProperty(actor.inventory, 'bulk', {\r\n        get() {\r\n            const inventoryBulk = new InventoryBulk(actor)\r\n            inventoryBulk.value = InventoryBulk.computeTotalBulk(\r\n                actor.inventory.filter(i => !i.isInContainer && i.system.equipped.carryType !== 'dropped'),\r\n                actor.size\r\n            )\r\n            return inventoryBulk\r\n        },\r\n    })\r\n}\r\n", "import { MODULE_ID, getSetting, localeCompare, templatePath } from '../module'\r\nimport { createChoicesHook } from './shared/hook'\r\n\r\nconst setHook = createChoicesHook('renderCharacterSheetPF2e', renderCharacterSheetPF2e, refreshSheets)\r\n\r\nexport function registerSpellsSummary() {\r\n    return {\r\n        settings: [\r\n            {\r\n                name: 'summary',\r\n                type: String,\r\n                default: 'disabled',\r\n                scope: 'client',\r\n                choices: ['disabled', 'enabled', 'sort'],\r\n                onChange: setHook,\r\n            },\r\n        ],\r\n        conflicts: ['pf2e-spells-summary'],\r\n        init: isGm => {\r\n            if (getSetting('summary') !== 'disabled') setHook(true)\r\n        },\r\n    }\r\n}\r\n\r\nfunction refreshSheets() {\r\n    Object.values(ui.windows).forEach(win => win instanceof ActorSheet && win.actor.type === 'character' && win.render())\r\n}\r\n\r\nasync function renderCharacterSheetPF2e(sheet, html) {\r\n    const actor = sheet.actor\r\n    if (!actor || actor.pack || !actor.id || !actor.isOfType('character')) return\r\n\r\n    const tab = getSpellcastingTab(html)\r\n\r\n    if (getProperty(sheet, `modules.${MODULE_ID}.toggled`)) tab.addClass('toggled')\r\n\r\n    getSpellcastingNav(html).on('click', event => onSpellcastingBtnToggle(event, html, sheet))\r\n    await addSummaryTab(html, sheet, actor)\r\n\r\n    if (tab.hasClass('toggled') && tab.hasClass('active')) {\r\n        sheet._restoreScrollPositions(html)\r\n    }\r\n}\r\n\r\nasync function addSummaryTab(html, sheet, actor) {\r\n    const tab = getSpellcastingTab(html)\r\n    const data = await getData(actor)\r\n\r\n    const template = await renderTemplate(templatePath('summary/sheet'), data)\r\n\r\n    tab.append(template)\r\n    addSummaryEvents(html, sheet, actor)\r\n}\r\n\r\nfunction addSummaryEvents(html, sheet, actor) {\r\n    const summary = getSpellcastingSummarySection(html)\r\n\r\n    const inputs = summary.find('.spell-type .uses .spell-slots-input input')\r\n    inputs.on('change', event => onUsesInputChange(event, actor))\r\n    inputs.on('focus', onUsesInputFocus)\r\n    inputs.on('blur', onUsesInputBlur)\r\n\r\n    summary.find('.cast-spell').on('click', event => onCastSpell(event, actor))\r\n    summary.find('.item-toggle-prepare').on('click', event => onTogglePrepare(event, actor))\r\n    summary.find('.focus-pips').on('click contextmenu', event => onToggleFocusPool(event, actor))\r\n    summary.find('.spell-slots-increment-reset').on('click', event => onSlotsReset(event, sheet, actor))\r\n    summary.find('.item-image').on('click', event => onItemToChat(event, actor))\r\n    summary.find('.item-name > h4').on('click', event => onToggleSummary(event, sheet))\r\n}\r\n\r\nasync function onUsesInputChange(event, actor) {\r\n    event.preventDefault()\r\n\r\n    const { inputPath, entryId } = $(event.currentTarget).data()\r\n    const value = event.currentTarget.valueAsNumber\r\n    actor.updateEmbeddedDocuments('Item', [{ _id: entryId, [inputPath]: value }])\r\n}\r\n\r\nfunction onUsesInputFocus(event) {\r\n    event.preventDefault()\r\n    event.currentTarget.closest('.item')?.classList.add('hover')\r\n}\r\n\r\nfunction onUsesInputBlur(event) {\r\n    event.preventDefault()\r\n    event.currentTarget.closest('.item')?.classList.remove('hover')\r\n}\r\n\r\nfunction onTogglePrepare(event, actor) {\r\n    event.preventDefault()\r\n    const { slotLevel, slotId, entryId, expended } = $(event.currentTarget).closest('.item').data()\r\n    const collection = actor.spellcasting.collections.get(entryId)\r\n    collection?.setSlotExpendedState(slotLevel ?? 0, slotId ?? 0, expended !== true)\r\n}\r\n\r\nfunction onToggleFocusPool(event, actor) {\r\n    event.preventDefault()\r\n    const change = event.type === 'click' ? 1 : -1\r\n    const points = (actor.system.resources.focus?.value ?? 0) + change\r\n    actor.update({ 'system.resources.focus.value': points })\r\n}\r\n\r\nfunction onChargeReset(sheet, entryId) {\r\n    const original = getSpellcastingOriginalSection(sheet.element)\r\n    const entry = original.find(`.item-container.spellcasting-entry[data-item-id=${entryId}]`)\r\n    const btn = entry.find('.spell-ability-data .statistic-values a.pf2e-staves-charge')\r\n    btn[0]?.click()\r\n}\r\n\r\nfunction onSlotsReset(event, sheet, actor) {\r\n    event.preventDefault()\r\n\r\n    const { itemId, level, isCharge } = $(event.currentTarget).data()\r\n    if (!itemId) return\r\n\r\n    if (isCharge) {\r\n        onChargeReset(sheet, itemId)\r\n        return\r\n    }\r\n\r\n    const item = actor.items.get(itemId)\r\n    if (!item) return\r\n\r\n    if (item.isOfType('spellcastingEntry')) {\r\n        const slotLevel = level >= 0 && level <= 11 ? `slot${level}` : 'slot0'\r\n        const slot = item.system.slots?.[slotLevel]\r\n        if (slot) item.update({ [`system.slots.${slotLevel}.value`]: slot.max })\r\n    } else if (item.isOfType('spell')) {\r\n        const max = item.system.location.uses?.max\r\n        if (max) item.update({ 'system.location.uses.value': max })\r\n    }\r\n}\r\n\r\nfunction onCastSpell(event, actor) {\r\n    event.preventDefault()\r\n\r\n    const target = $(event.currentTarget)\r\n    if (target.prop('disabled')) return\r\n\r\n    const { itemId, slotLevel, slotId, entryId } = target.closest('.item').data()\r\n    const collection = actor.spellcasting.collections.get(entryId)\r\n    if (!collection) return\r\n\r\n    const spell = collection.get(itemId)\r\n    if (!spell) return\r\n\r\n    collection.entry.cast(spell, { slot: slotId, level: slotLevel })\r\n}\r\n\r\nasync function onToggleSummary(event, sheet) {\r\n    const item = event.currentTarget.closest('.item')\r\n    await sheet.itemRenderer.toggleSummary(item)\r\n}\r\n\r\nasync function onItemToChat(event, actor) {\r\n    const itemId = $(event.currentTarget).closest('.item').attr('data-item-id')\r\n    const item = actor.items.get(itemId)\r\n    if (!item || (item.isOfType('physical') && !item.isIdentified)) return\r\n    await item.toMessage(event)\r\n}\r\n\r\nfunction onSpellcastingBtnToggle(event, html, sheet) {\r\n    event.preventDefault()\r\n\r\n    const tab = getSpellcastingTab(html)\r\n\r\n    if (tab.hasClass('active')) {\r\n        tab.toggleClass('toggled')\r\n        tab.scrollTop(0)\r\n        setProperty(sheet, `modules.${MODULE_ID}.toggled`, tab.hasClass('toggled'))\r\n    }\r\n}\r\n\r\nfunction getSpellcastingNav(html) {\r\n    return html.find('nav.sheet-navigation .item[data-tab=spellcasting]')\r\n}\r\n\r\nfunction getSpellcastingTab(html) {\r\n    return html.find('section.sheet-body .sheet-content > .tab[data-tab=spellcasting]')\r\n}\r\n\r\nfunction getSpellcastingOriginalSection(html) {\r\n    return getSpellcastingTab(html).find('.directory-list.spellcastingEntry-list')\r\n}\r\n\r\nfunction getSpellcastingSummarySection(html) {\r\n    return getSpellcastingTab(html).find('.directory-list.summary')\r\n}\r\n\r\nasync function getData(actor) {\r\n    const focusPool = actor.system.resources.focus ?? { value: 0, max: 0 }\r\n    const stavesActive = game.modules.get('pf2e-staves')?.active\r\n    const spells = []\r\n    const focuses = []\r\n\r\n    let hasFocusCantrips = false\r\n\r\n    await Promise.all(\r\n        actor.spellcasting.regular.map(async entry => {\r\n            const entryId = entry.id\r\n            const entryDc = entry.statistic.dc.value\r\n            const entryName = entry.name\r\n            const data = await entry.getSheetData()\r\n            const isFocus = data.isFocusPool\r\n            const isCharge = entry.system?.prepared?.value === 'charge'\r\n            const isStaff = getProperty(entry, 'flags.pf2e-staves.staveID') !== undefined\r\n            const charges = { value: getProperty(entry, 'flags.pf2e-staves.charges') ?? 0 }\r\n\r\n            for (const slot of data.levels) {\r\n                if (!slot.active.length || slot.uses?.max === 0) continue\r\n\r\n                const slotSpells = []\r\n                const isCantrip = slot.isCantrip\r\n                const actives = slot.active.filter(x => x && x.uses?.max !== 0)\r\n                const isBroken = !isCantrip && isCharge && !stavesActive\r\n\r\n                for (let slotId = 0; slotId < actives.length; slotId++) {\r\n                    const { spell, expended, virtual, uses, castLevel } = actives[slotId]\r\n\r\n                    slotSpells.push({\r\n                        name: spell.name,\r\n                        img: spell.img,\r\n                        range: spell.system.range.value || '-',\r\n                        castLevel: castLevel ?? spell.level,\r\n                        slotId,\r\n                        entryId,\r\n                        entryDc,\r\n                        entryName,\r\n                        itemId: spell.id,\r\n                        inputId: data.isInnate ? spell.id : data.id,\r\n                        inputPath: isCharge\r\n                            ? 'flags.pf2e-staves.charges'\r\n                            : data.isInnate\r\n                            ? 'system.location.uses.value'\r\n                            : `system.slots.slot${slot.level}.value`,\r\n                        isCharge,\r\n                        isActiveCharge: isCharge && stavesActive,\r\n                        isBroken,\r\n                        isVirtual: virtual,\r\n                        isInnate: data.isInnate,\r\n                        isCantrip: isCantrip,\r\n                        isFocus,\r\n                        isPrepared: data.isPrepared,\r\n                        isSpontaneous: data.isSpontaneous || data.isFlexible,\r\n                        slotLevel: slot.level,\r\n                        uses: uses ?? (isCharge ? charges : slot.uses),\r\n                        expended: expended ?? (isFocus && !isCantrip ? focusPool.value <= 0 : false),\r\n                        action: spell.system.time.value,\r\n                        type: isCharge\r\n                            ? isStaff\r\n                                ? `${MODULE_ID}.summary.staff`\r\n                                : `${MODULE_ID}.summary.charges`\r\n                            : data.isInnate\r\n                            ? 'PF2E.PreparationTypeInnate'\r\n                            : data.isSpontaneous\r\n                            ? 'PF2E.PreparationTypeSpontaneous'\r\n                            : data.isFlexible\r\n                            ? 'PF2E.SpellFlexibleLabel'\r\n                            : isFocus\r\n                            ? 'PF2E.SpellFocusLabel'\r\n                            : 'PF2E.SpellPreparedLabel',\r\n                        order: isCharge ? 0 : data.isPrepared ? 1 : isFocus ? 2 : data.isInnate ? 3 : data.isSpontaneous ? 4 : 5,\r\n                        noHover: data.isPrepared || isCantrip || isBroken || isFocus,\r\n                    })\r\n                }\r\n\r\n                if (slotSpells.length) {\r\n                    if (isFocus) {\r\n                        if (isCantrip) hasFocusCantrips = true\r\n                        else {\r\n                            focuses.push(...slotSpells)\r\n                            continue\r\n                        }\r\n                    }\r\n\r\n                    spells[slot.level] ??= []\r\n                    spells[slot.level].push(...slotSpells)\r\n                }\r\n            }\r\n        })\r\n    )\r\n\r\n    if (spells.length) {\r\n        const sort =\r\n            getSetting('summary') === 'sort'\r\n                ? (a, b) => (a.order === b.order ? localeCompare(a.name, b.name) : a.order - b.order)\r\n                : (a, b) => localeCompare(a.name, b.name)\r\n        spells.forEach(entry => entry.sort(sort))\r\n    }\r\n\r\n    if (focuses.length) {\r\n        focuses.sort((a, b) => localeCompare(a.name, b.name))\r\n        spells[12] = focuses\r\n        hasFocusCantrips = false\r\n    }\r\n\r\n    const ritualData = await actor.spellcasting.ritual?.getSheetData()\r\n    const rituals = ritualData?.levels.flatMap((slot, slotId) =>\r\n        slot.active\r\n            .map(({ spell }) => ({\r\n                name: spell.name,\r\n                img: spell.img,\r\n                slotId,\r\n                itemId: spell.id,\r\n                level: spell.level,\r\n                time: spell.system.time.value,\r\n            }))\r\n            .filter(Boolean)\r\n    )\r\n\r\n    return {\r\n        spells,\r\n        rituals,\r\n        focusPool,\r\n        stavesActive,\r\n        hasFocusCantrips,\r\n        isOwner: actor.isOwner,\r\n    }\r\n}\r\n", "import { getSetting } from '../module'\r\n\r\nlet CREATE_HOOK = null\r\nlet UPDATE_HOOK = null\r\n\r\nexport function registerUnided() {\r\n    return {\r\n        settings: [\r\n            {\r\n                name: 'unided',\r\n                type: String,\r\n                default: 'disabled',\r\n                choices: ['disabled', 'create', 'all'],\r\n                onChange: setHooks,\r\n            },\r\n        ],\r\n        conflicts: ['pf2e-unided'],\r\n        init: () => {\r\n            setHooks()\r\n        },\r\n    }\r\n}\r\n\r\nfunction setHooks(value) {\r\n    value ??= getSetting('unided')\r\n\r\n    if (value === 'disabled') {\r\n        if (CREATE_HOOK) {\r\n            Hooks.off('preCreateItem', CREATE_HOOK)\r\n            CREATE_HOOK = null\r\n        }\r\n        if (UPDATE_HOOK) {\r\n            Hooks.off('preUpdateItem', UPDATE_HOOK)\r\n            UPDATE_HOOK = null\r\n        }\r\n    } else {\r\n        if (!CREATE_HOOK) {\r\n            CREATE_HOOK = Hooks.on('preCreateItem', preCreateItem)\r\n        }\r\n        if (value === 'all' && !UPDATE_HOOK) {\r\n            UPDATE_HOOK = Hooks.on('preUpdateItem', preUpdateItem)\r\n        } else if (value !== 'all' && UPDATE_HOOK) {\r\n            Hooks.off('preUpdateItem', UPDATE_HOOK)\r\n            UPDATE_HOOK = null\r\n        }\r\n    }\r\n}\r\n\r\nfunction preCreateItem(item) {\r\n    if (!item.img || !item.isOfType('physical')) return\r\n    item._source.system.identification.unidentified.img = item.img\r\n}\r\n\r\nfunction preUpdateItem(item, changes) {\r\n    if (!item.isOfType('physical') || !('img' in changes)) return\r\n    setProperty(changes, 'system.identification.unidentified.img', changes.img)\r\n}\r\n", "import { MODULE_ID, warn } from './module'\r\nimport { registerArp } from './modules/arp'\r\nimport { registerEffectsPanelHelper } from './modules/effects'\r\nimport { registerGiveth } from './modules/giveth'\r\nimport { registerKnowledges } from './modules/knowledges'\r\nimport { registerMerge } from './modules/merge'\r\nimport { registerNobulk } from './modules/nobulk'\r\nimport { registerSpellsSummary } from './modules/summary'\r\nimport { registerUnided } from './modules/unided'\r\n\r\nconst MODULES = [\r\n    registerArp(),\r\n    registerNobulk(),\r\n    registerGiveth(),\r\n    registerKnowledges(),\r\n    registerUnided(),\r\n    registerMerge(),\r\n    registerEffectsPanelHelper(),\r\n    registerSpellsSummary(),\r\n]\r\nconst CONFLICTS = new Set()\r\n\r\nHooks.once('init', () => {\r\n    const user = game.data.users.find(x => x._id === game.data.userId)\r\n    const isGM = user && user.role >= CONST.USER_ROLES.GAMEMASTER\r\n\r\n    for (const module of MODULES) {\r\n        const { settings = [], init, conflicts = [] } = module\r\n\r\n        for (const setting of settings) {\r\n            const name = setting.name\r\n\r\n            if (setting.choices) {\r\n                setting.choices = setting.choices.reduce((choices, choice) => {\r\n                    choices[choice] = settingPath(name, `choices.${choice}`)\r\n                    return choices\r\n                }, {})\r\n            }\r\n\r\n            game.settings.register(MODULE_ID, name, {\r\n                scope: 'world',\r\n                config: true,\r\n                ...setting,\r\n                name: settingPath(name, 'name'),\r\n                hint: settingPath(name, 'hint'),\r\n            })\r\n        }\r\n\r\n        if (isGM) {\r\n            for (const id of conflicts) {\r\n                const conflictingModule = game.modules.get(id)\r\n                if (conflictingModule?.active) {\r\n                    module.conflicting = true\r\n                    CONFLICTS.add(conflictingModule.title)\r\n                }\r\n            }\r\n        }\r\n\r\n        if (!module.conflicting && init) init(isGM)\r\n    }\r\n})\r\n\r\nHooks.once('ready', () => {\r\n    const isGM = game.user.isGM\r\n\r\n    for (const { conflicting, ready } of MODULES) {\r\n        if (!conflicting && ready) ready(isGM)\r\n    }\r\n\r\n    if (isGM) {\r\n        for (const conflict of CONFLICTS) {\r\n            warn('module-conflict', { name: conflict }, true)\r\n        }\r\n    }\r\n})\r\n\r\nfunction settingPath(setting, key) {\r\n    return `${MODULE_ID}.settings.${setting}.${key}`\r\n}\r\n"],
  "mappings": "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",
  "names": ["MODULE_ID", "getSetting", "setting", "__name", "localize", "args", "key", "data", "hasLocalization", "localizePath", "subLocalize", "subKey", "fn", "warn", "info", "error", "hash", "notify", "str", "arg1", "arg2", "arg3", "type", "permanent", "registerWrapper", "path", "callback", "getFlag", "doc", "fallback", "setFlag", "value", "templatePath", "x", "localeCompare", "a", "b", "socketOn", "socketOff", "socketEmit", "packet", "isActiveGM", "registerUpstreamHook", "hook", "id", "index", "hooked", "isGMOnline", "user", "chatUUID", "uuid", "label", "fake", "PREPARE_WEAPON_DATA", "PREPARE_WEAPON_DERIVED_DATA", "PREPARE_ARMOR_DATA", "PREPARE_ARMOR_DERIVED_DATA", "WEAPON_EXCLUDES", "registerArp", "getSetting", "registerWrapper", "onPrepareWeaponData", "onPrepareWeaponDerivedData", "onPrepareArmorData", "onPrepareArmorDerivedData", "isGM", "info", "__name", "isValidActor", "actor", "isCharacter", "isValidWeapon", "weapon", "traits", "wrapped", "level", "WEAPON_POTENCY_PRICE", "WEAPON_STRIKING_PRICE", "gp", "potency", "striking", "isValidArmor", "armor", "ARMOR_POTENCY_PRICE", "ARMOR_RESILIENCY_PRICE", "resiliency", "createHook", "event", "listener", "callback", "HOOK", "value", "otherSettings", "s", "getSetting", "__name", "createChoicesHook", "setHook", "createHook", "renderEffectsPanel", "refreshEffectsPanel", "registerEffectsPanelHelper", "value", "__name", "panel", "html", "removeRow", "localize", "editIcon", "effectPanels", "effectPanel", "id", "effect", "getSetting", "event", "onRemoveEffect", "h1", "onConditionSheet", "getEffect", "MoveLootPopup", "object", "options", "callback", "prompt", "buttonLabel", "_event", "formData", "__name", "enabled", "CANVAS_HOOK", "registerGiveth", "setup", "isGM", "getSetting", "__name", "value", "socketOff", "onSocket", "socketOn", "registerUpstreamHook", "onDropCanvasData", "packet", "isActiveGM", "takethCondition", "takethEffect", "takethPhysical", "canvas", "data", "isGMOnline", "details", "getDetailsFromData", "target", "token", "isValidActor", "maximumX", "maximumY", "a", "b", "giveth", "origin", "item", "ownerId", "targetId", "isIndex", "qty", "warn", "sendPhysicalRequest", "MoveLootPopup", "stack", "uuid", "socketEmit", "itemId", "actor", "id", "actorUUID", "source", "owner", "newQty", "newItem", "content", "chatUUID", "localize", "localize", "subLocalize", "EditLores", "templatePath", "options", "actor", "getFlag", "event", "unspecified", "specific", "setFlag", "html", "#onCancel", "__name", "setHook", "createHook", "renderNPCSheetPF2e", "registerKnowledges", "isGM", "getSetting", "__name", "sheet", "$html", "actor", "replaceLores", "addEditButton", "addEvents", "knowledgeSelector", "html", "section", "selector", "editLores", "EditLores", "unspecifics", "getFlag", "specifics", "lores", "body", "tag", "skills", "dc", "adjustment", "addTags", "start", "tags", "lore", "attempts", "edit", "localize", "subLocalize", "MultiCast", "spell", "options", "templatePath", "html", "#onCast", "#onCancel", "event", "nb", "damages", "heightening", "id", "damage", "i", "newId", "level", "data", "__name", "FLAVOR_TAGS", "FLAVOR_MODIFIERS", "FORMULA_STRIP", "setHook", "createHook", "renderChatMessage", "updateMessages", "registerMerge", "value", "isGm", "__name", "chat", "message", "chatMessages", "html", "getSetting", "isDamageRoll", "renderDamage", "renderSpell", "uuid", "spellBtn", "localize", "event", "spell", "MultiCast", "getMessageUuid", "button", "originTarget", "getMessageTarget", "otherMessage", "mergeDamages", "warn", "origin", "other", "name", "getItemName", "tags", "getTags", "notes", "getMessageNotes", "modifiers", "getMessageModifiers", "target", "note", "modifier", "originRolls", "getMessageRolls", "otherRolls", "grouped", "findGroup", "options", "flavor", "critRule", "roll", "total", "terms", "term", "formula", "group", "createTermGroup", "acc", "templatePath", "MODULE_ID", "nb", "fromMessage", "messages", "start", "m", "getFlag", "getMessageFlag", "m1", "m2", "title", "text", "match", "systemFlag", "moduleFlag", "ACTOR_PREPARE_EMBEDDED_DOCUMENTS", "registerNobulk", "getSetting", "registerWrapper", "actorPrepareEmbeddedDocuments", "__name", "wrapped", "args", "actor", "InventoryBulk", "inventoryBulk", "i", "setHook", "createChoicesHook", "renderCharacterSheetPF2e", "refreshSheets", "registerSpellsSummary", "isGm", "getSetting", "__name", "win", "sheet", "html", "actor", "tab", "getSpellcastingTab", "MODULE_ID", "getSpellcastingNav", "event", "onSpellcastingBtnToggle", "addSummaryTab", "data", "getData", "template", "templatePath", "addSummaryEvents", "summary", "getSpellcastingSummarySection", "inputs", "onUsesInputChange", "onUsesInputFocus", "onUsesInputBlur", "onCastSpell", "onTogglePrepare", "onToggleFocusPool", "onSlotsReset", "onItemToChat", "onToggleSummary", "inputPath", "entryId", "value", "slotLevel", "slotId", "expended", "change", "points", "onChargeReset", "getSpellcastingOriginalSection", "itemId", "level", "isCharge", "item", "slot", "max", "target", "collection", "spell", "focusPool", "stavesActive", "spells", "focuses", "hasFocusCantrips", "entry", "entryDc", "entryName", "isFocus", "isStaff", "charges", "slotSpells", "isCantrip", "actives", "x", "isBroken", "virtual", "uses", "castLevel", "sort", "a", "b", "localeCompare", "rituals", "CREATE_HOOK", "UPDATE_HOOK", "registerUnided", "setHooks", "__name", "value", "getSetting", "preCreateItem", "preUpdateItem", "item", "changes", "MODULES", "registerArp", "registerNobulk", "registerGiveth", "registerKnowledges", "registerUnided", "registerMerge", "registerEffectsPanelHelper", "registerSpellsSummary", "CONFLICTS", "user", "x", "isGM", "module", "settings", "init", "conflicts", "setting", "name", "choices", "choice", "settingPath", "MODULE_ID", "id", "conflictingModule", "conflicting", "ready", "conflict", "warn", "key", "__name"]
}
