{
  "version": 3,
  "sources": ["../src/module.js", "../src/modules/arp.js", "../src/modules/shared/hook.js", "../src/modules/effects.js", "../src/apps/knowledges/lores.js", "../src/modules/knowledges.js", "../src/apps/merge/multi.js", "../src/modules/merge.js", "../src/modules/nobulk.js", "../src/modules/unided.js", "../src/main.js"],
  "sourcesContent": ["export const MODULE_ID = 'pf2e-toolbelt'\r\n\r\nexport function getSetting(setting) {\r\n    return game.settings.get(MODULE_ID, setting)\r\n}\r\n\r\nexport function localize(...args) {\r\n    let [key, data] = args\r\n    key = `${MODULE_ID}.${key}`\r\n    if (data) return game.i18n.format(key, data)\r\n    return game.i18n.localize(key)\r\n}\r\n\r\nexport function hasLocalization(key) {\r\n    return game.i18n.has(`${MODULE_ID}.${key}`, false)\r\n}\r\n\r\nexport function localizePath(key) {\r\n    return `${MODULE_ID}.${key}`\r\n}\r\n\r\nexport function subLocalize(subKey) {\r\n    const fn = (...args) => localize(`${subKey}.${args[0]}`, args[1])\r\n\r\n    Object.defineProperties(fn, {\r\n        warn: {\r\n            value: (...args) => warn(`${subKey}.${args[0]}`, args[1], args[2]),\r\n            enumerable: false,\r\n            configurable: false,\r\n        },\r\n        info: {\r\n            value: (...args) => info(`${subKey}.${args[0]}`, args[1], args[2]),\r\n            enumerable: false,\r\n            configurable: false,\r\n        },\r\n        error: {\r\n            value: (...args) => error(`${subKey}.${args[0]}`, args[1], args[2]),\r\n            enumerable: false,\r\n            configurable: false,\r\n        },\r\n        has: {\r\n            value: key => hasLocalization(`${subKey}.${key}`),\r\n            enumerable: false,\r\n            configurable: false,\r\n        },\r\n        path: {\r\n            value: key => localizePath(`${subKey}.${key}`),\r\n            enumerable: false,\r\n            configurable: false,\r\n        },\r\n        template: {\r\n            value: (key, { hash }) => fn(key, hash),\r\n            enumerable: false,\r\n            configurable: false,\r\n        },\r\n    })\r\n\r\n    return fn\r\n}\r\n\r\nfunction notify(str, arg1, arg2, arg3) {\r\n    const type = typeof arg1 === 'string' ? arg1 : 'info'\r\n    const data = typeof arg1 === 'object' ? arg1 : typeof arg2 === 'object' ? arg2 : undefined\r\n    const permanent = typeof arg1 === 'boolean' ? arg1 : typeof arg2 === 'boolean' ? arg2 : arg3 ?? false\r\n\r\n    ui.notifications.notify(localize(str, data), type, { permanent })\r\n}\r\n\r\nexport function warn(...args) {\r\n    const [str, arg1, arg2] = args\r\n    notify(str, 'warning', arg1, arg2)\r\n}\r\n\r\nexport function info(...args) {\r\n    const [str, arg1, arg2] = args\r\n    notify(str, 'info', arg1, arg2)\r\n}\r\n\r\nexport function error(...args) {\r\n    const [str, arg1, arg2] = args\r\n    notify(str, 'error', arg1, arg2)\r\n}\r\n\r\nexport function registerWrapper(path, callback) {\r\n    libWrapper.register(MODULE_ID, path, callback)\r\n}\r\n\r\nexport function getFlag(doc, key, fallback) {\r\n    return doc.getFlag(MODULE_ID, key) ?? fallback\r\n}\r\n\r\nexport function setFlag(doc, key, value) {\r\n    return doc.setFlag(MODULE_ID, key, value)\r\n}\r\n\r\nexport function templatePath(...path) {\r\n    path = path.filter(x => typeof x === 'string')\r\n    return `modules/${MODULE_ID}/templates/${path.join('/')}.hbs`\r\n}\r\n", "import { getSetting, info, registerWrapper } from '../module'\r\n\r\nconst PREPARE_WEAPON_DATA = 'CONFIG.PF2E.Item.documentClasses.weapon.prototype.prepareBaseData'\r\nconst PREPARE_WEAPON_DERIVED_DATA = 'CONFIG.PF2E.Item.documentClasses.weapon.prototype.prepareDerivedData'\r\nconst PREPARE_ARMOR_DATA = 'CONFIG.PF2E.Item.documentClasses.armor.prototype.prepareBaseData'\r\nconst PREPARE_ARMOR_DERIVED_DATA = 'CONFIG.PF2E.Item.documentClasses.armor.prototype.prepareDerivedData'\r\n\r\nconst WEAPON_EXCLUDES = ['Compendium.pf2e.equipment-srd.Item.ZhxxqYpVdVx0jSMm']\r\n\r\nexport function registerArp() {\r\n    return {\r\n        settings: [\r\n            {\r\n                name: 'arp',\r\n                type: Boolean,\r\n                default: false,\r\n                requiresReload: true,\r\n            },\r\n        ],\r\n        conflicts: ['pf2e-arp'],\r\n        init: () => {\r\n            if (!getSetting('arp')) return\r\n            registerWrapper(PREPARE_WEAPON_DATA, onPrepareWeaponData, 'WRAPPER')\r\n            registerWrapper(PREPARE_WEAPON_DERIVED_DATA, onPrepareWeaponDerivedData, 'WRAPPER')\r\n            registerWrapper(PREPARE_ARMOR_DATA, onPrepareArmorData, 'WRAPPER')\r\n            registerWrapper(PREPARE_ARMOR_DERIVED_DATA, onPrepareArmorDerivedData, 'WRAPPER')\r\n        },\r\n        ready: isGM => {\r\n            if (isGM && getSetting('arp') && game.settings.get('pf2e', 'automaticBonusVariant') !== 'noABP') {\r\n                game.settings.set('pf2e', 'automaticBonusVariant', 'noABP')\r\n                info('arp.forceVariant')\r\n            }\r\n        },\r\n    }\r\n}\r\n\r\nfunction isValidActor(actor, isCharacter = false) {\r\n    return actor && !actor.getFlag('pf2e', 'disableABP') && (!isCharacter || actor.isOfType('character'))\r\n}\r\n\r\nfunction isValidWeapon(weapon) {\r\n    const traits = weapon._source.system.traits.value\r\n    return !traits.includes('alchemical') && !traits.includes('bomb') && !WEAPON_EXCLUDES.includes(weapon.sourceId)\r\n}\r\n\r\nfunction onPrepareWeaponData(wrapped) {\r\n    const actor = this.actor\r\n    if (!isValidActor(actor, true) || !isValidWeapon(this)) return wrapped()\r\n\r\n    const level = actor.level\r\n\r\n    const traits = this._source.system.traits.value\r\n    if (traits.includes('alchemical') && traits.includes('bomb')) return wrapped()\r\n\r\n    this.system.potencyRune.value = level < 2 ? null : level < 10 ? 1 : level < 16 ? 2 : 3\r\n    this.system.strikingRune.value = level < 4 ? null : level < 12 ? 'striking' : level < 19 ? 'greaterStriking' : 'majorStriking'\r\n\r\n    wrapped()\r\n}\r\n\r\nconst WEAPON_POTENCY_PRICE = {\r\n    1: 35,\r\n    2: 935,\r\n    3: 8935,\r\n    4: 8935,\r\n}\r\nconst WEAPON_STRIKING_PRICE = {\r\n    striking: 65,\r\n    greaterStriking: 1065,\r\n    majorStriking: 31065,\r\n}\r\nfunction onPrepareWeaponDerivedData(wrapped) {\r\n    wrapped()\r\n\r\n    if (!isValidActor(this.actor) || this.isSpecific || !isValidWeapon(this)) return\r\n\r\n    let gp = this.price.value.goldValue\r\n\r\n    const potency = this.system.potencyRune.value\r\n    if (potency) gp -= WEAPON_POTENCY_PRICE[potency]\r\n\r\n    const striking = this.system.strikingRune.value\r\n    if (striking) gp -= WEAPON_STRIKING_PRICE[striking]\r\n\r\n    if ((potency || striking) && !this.system.runes.property.length)\r\n        gp += new game.pf2e.Coins(this._source.system.price.value).goldValue\r\n\r\n    this.system.price.value = new game.pf2e.Coins({ gp })\r\n}\r\n\r\nfunction isValidArmor(armor) {\r\n    return !armor.isShield\r\n}\r\n\r\nfunction onPrepareArmorData(wrapped) {\r\n    const actor = this.actor\r\n    if (!isValidActor(actor, true) || !isValidArmor(this)) return wrapped()\r\n\r\n    const level = actor.level\r\n\r\n    this.system.potencyRune.value = level < 5 ? null : level < 11 ? 1 : level < 18 ? 2 : 3\r\n    this.system.resiliencyRune.value =\r\n        level < 8 ? null : level < 14 ? 'resilient' : level < 20 ? 'greaterResilient' : 'majorResilient'\r\n\r\n    wrapped()\r\n}\r\n\r\nconst ARMOR_POTENCY_PRICE = {\r\n    1: 160,\r\n    2: 1060,\r\n    3: 20560,\r\n    4: 20560,\r\n}\r\nconst ARMOR_RESILIENCY_PRICE = {\r\n    resilient: 340,\r\n    greaterResilient: 3440,\r\n    majorResilient: 49440,\r\n}\r\nfunction onPrepareArmorDerivedData(wrapped) {\r\n    wrapped()\r\n\r\n    if (!isValidActor(this.actor) || this.isSpecific || !isValidArmor(this)) return\r\n\r\n    let gp = this.price.value.goldValue\r\n\r\n    const potency = this.system.potencyRune.value\r\n    if (potency) gp -= ARMOR_POTENCY_PRICE[potency]\r\n\r\n    const resiliency = this.system.resiliencyRune.value\r\n    if (resiliency) gp -= ARMOR_RESILIENCY_PRICE[resiliency]\r\n\r\n    if ((potency || resiliency) && !this.system.runes.property.length)\r\n        gp += new game.pf2e.Coins(this._source.system.price.value).goldValue\r\n\r\n    this.system.price.value = new game.pf2e.Coins({ gp })\r\n}\r\n", "import { getSetting } from '../../module'\r\n\r\nexport function createHook(event, listener, callback = () => {}) {\r\n    let HOOK = null\r\n\r\n    return function (value, otherSettings = []) {\r\n        if (typeof otherSettings === 'string') otherSettings = [otherSettings]\r\n\r\n        value ||= otherSettings.some(s => getSetting(s))\r\n\r\n        if (value && !HOOK) {\r\n            HOOK = Hooks.on(event, listener)\r\n        } else if (!value && HOOK) {\r\n            Hooks.off(event, HOOK)\r\n            HOOK = null\r\n        }\r\n\r\n        callback(value)\r\n    }\r\n}\r\n", "import { getSetting, localize } from '../module'\r\nimport { createHook } from './shared/hook'\r\n\r\nconst setHook = createHook('renderEffectsPanel', renderEffectsPanel, refreshEffectsPanel)\r\n\r\nexport function registerEffectsPanelHelper() {\r\n    return {\r\n        settings: [\r\n            {\r\n                name: 'effect-remove',\r\n                type: Boolean,\r\n                default: false,\r\n                scope: 'client',\r\n                onChange: value => setHook(value, 'condition-sheet'),\r\n            },\r\n            {\r\n                name: 'condition-sheet',\r\n                type: Boolean,\r\n                default: false,\r\n                scope: 'client',\r\n                onChange: value => setHook(value, 'effect-remove'),\r\n            },\r\n        ],\r\n        conflicts: ['pf2e-effect-description'],\r\n        init: () => {\r\n            setHook(false, ['effect-remove', 'condition-sheet'])\r\n        },\r\n    }\r\n}\r\n\r\nfunction refreshEffectsPanel() {\r\n    game.pf2e.effectPanel?.render()\r\n}\r\n\r\nfunction renderEffectsPanel(panel, html) {\r\n    const removeRow = `<div>${localize('effects.remove')}</div>`\r\n    const editIcon = `<a data-action=\"edit\" data-tooltip=\"Edit Item\"><i class=\"fa-solid fa-fw fa-pencil\"></i></a>`\r\n\r\n    const effectPanels = html.find('.effect-item[data-item-id]').toArray()\r\n    for (const effectPanel of effectPanels) {\r\n        const id = effectPanel.dataset.itemId\r\n        const effect = panel.actor?.items.get(id)\r\n        if (!effect) continue\r\n\r\n        if (getSetting('effect-remove') && !effect.isLocked && effect.badge && effect.badge.type === 'counter') {\r\n            effectPanel.querySelector('.effect-info .instructions').insertAdjacentHTML('beforeend', removeRow)\r\n            effectPanel.querySelector('.icon').addEventListener('contextmenu', event => onRemoveEffect(event, panel), true)\r\n        }\r\n\r\n        if (getSetting('condition-sheet') && effect.isOfType('condition')) {\r\n            const h1 = effectPanel.querySelector('.effect-info > h1')\r\n            h1.insertAdjacentHTML('beforeend', editIcon)\r\n            h1.querySelector('[data-action=\"edit\"]').addEventListener('click', event => onConditionSheet(event, panel))\r\n        }\r\n    }\r\n}\r\n\r\nfunction onConditionSheet(event, panel) {\r\n    const effect = getEffect(event, panel)\r\n    if (!effect?.isOfType('condition')) return\r\n    event.preventDefault()\r\n    effect.sheet.render(true)\r\n}\r\n\r\nfunction onRemoveEffect(event, panel) {\r\n    if (!event.shiftKey) return\r\n\r\n    const effect = getEffect(event, panel)\r\n    if (!effect || effect.isLocked || !effect.badge || effect.badge.type !== 'counter') return\r\n\r\n    event.preventDefault()\r\n    event.stopPropagation()\r\n    event.stopImmediatePropagation()\r\n\r\n    effect.delete()\r\n}\r\n\r\nfunction getEffect(event, panel) {\r\n    const target = event.currentTarget\r\n    const effect = target.closest('.effect-item[data-item-id]')\r\n    const id = effect.dataset.itemId\r\n    return panel.actor?.items.get(id)\r\n}\r\n", "import { getFlag, setFlag, subLocalize, templatePath } from '../../module'\r\n\r\nconst localize = subLocalize('knowledges.editLore')\r\n\r\nexport class EditLores extends FormApplication {\r\n    get actor() {\r\n        return this.object\r\n    }\r\n\r\n    get id() {\r\n        return `npc-edit-lores-${this.actor.id}`\r\n    }\r\n\r\n    get title() {\r\n        return localize('title', this.actor)\r\n    }\r\n\r\n    get template() {\r\n        return templatePath('knowledges/lores')\r\n    }\r\n\r\n    getData(options) {\r\n        const actor = this.actor\r\n\r\n        return mergeObject(super.getData(options), {\r\n            unspecified: getFlag(actor, 'unspecified') ?? '',\r\n            specific: getFlag(actor, 'specific') ?? '',\r\n            i18n: localize,\r\n        })\r\n    }\r\n\r\n    async _updateObject(event, { unspecified, specific }) {\r\n        const actor = this.object\r\n        setFlag(actor, 'unspecified', unspecified.trim())\r\n        setFlag(actor, 'specific', specific.trim())\r\n    }\r\n\r\n    activateListeners(html) {\r\n        html.find('button.cancel').on('click', this.#onCancel.bind(this))\r\n    }\r\n\r\n    #onCancel(event) {\r\n        event.preventDefault()\r\n        this.close()\r\n    }\r\n}\r\n", "import { EditLores } from '../apps/knowledges/lores'\r\nimport { getFlag, getSetting } from '../module'\r\nimport { createHook } from './shared/hook'\r\n\r\nconst setHook = createHook('renderNPCSheetPF2e', renderNPCSheetPF2e)\r\n\r\nexport function registerKnowledges() {\r\n    return {\r\n        settings: [\r\n            {\r\n                name: 'knowledges',\r\n                type: Boolean,\r\n                default: false,\r\n                onChange: setHook,\r\n            },\r\n        ],\r\n        conflicts: ['pf2e-npc-knowledges'],\r\n        ready: isGM => {\r\n            if (isGM && getSetting('knowledges')) setHook(true)\r\n        },\r\n    }\r\n}\r\n\r\nfunction renderNPCSheetPF2e(sheet, $html) {\r\n    const actor = sheet.actor\r\n\r\n    replaceLores(actor, $html)\r\n    addEditButton($html)\r\n    addEvents(actor, $html)\r\n}\r\n\r\nfunction knowledgeSelector(html, section, selector) {\r\n    return html.find(\r\n        `[data-tab=\"main\"] .recall-knowledge ${section === 'header' ? '.section-header' : '.section-body'} ${selector}`\r\n    )\r\n}\r\n\r\nfunction editLores(actor) {\r\n    new EditLores(actor).render(true)\r\n}\r\n\r\nfunction replaceLores(actor, html) {\r\n    const unspecifics = getFlag(actor, 'unspecified')\r\n    const specifics = getFlag(actor, 'specific')\r\n    if (!unspecifics && !specifics) return\r\n\r\n    const lores = actor.identificationDCs.lore\r\n    const body = knowledgeSelector(html, 'body', '')\r\n    body.find('.identification-skills').last().remove()\r\n\r\n    function tag(skills, dc, adjustment) {\r\n        const content = game.i18n.format('PF2E.Actor.NPC.Identification.Skills.Label', { skills, dc, adjustment })\r\n        return `<div class=\"tag-legacy identification-skills tooltipstered\">${content}</div>`\r\n    }\r\n\r\n    function addTags(lores, { dc, start }) {\r\n        const tags = lores\r\n            .split(',')\r\n            .filter(lore => lore.trim())\r\n            .map(lore => tag(lore, dc, start))\r\n            .join('')\r\n        body.append(tags)\r\n    }\r\n\r\n    addTags(unspecifics || 'Unspecific', lores[0])\r\n    addTags(specifics || 'Specific', lores[1])\r\n}\r\n\r\nfunction addEvents(actor, html) {\r\n    const edit = knowledgeSelector(html, 'header', 'button.edit')\r\n    edit.on('click', () => editLores(actor))\r\n}\r\n\r\nfunction addEditButton(html) {\r\n    const attempts = knowledgeSelector(html, 'header', 'button')\r\n    const edit = '<button type=\"button\" class=\"breakdown edit\">Edit</button>'\r\n    attempts.before(edit)\r\n}\r\n", "import { subLocalize, templatePath } from '../../module'\r\n\r\nconst localize = subLocalize('merge.multi')\r\n\r\nexport class MultiCast extends Application {\r\n    constructor(spell, options) {\r\n        super(options)\r\n        this._spell = spell\r\n    }\r\n\r\n    get spell() {\r\n        return this._spell\r\n    }\r\n\r\n    get title() {\r\n        return localize('title', this.spell)\r\n    }\r\n\r\n    get template() {\r\n        return templatePath('merge/multi')\r\n    }\r\n\r\n    getData(options) {\r\n        return mergeObject(super.getData(options), {\r\n            i18n: localize,\r\n        })\r\n    }\r\n\r\n    activateListeners(html) {\r\n        html.find('[data-action=cast]').on('click', this.#onCast.bind(this))\r\n        html.find('[data-action=cancel]').on('click', this.#onCancel.bind(this))\r\n    }\r\n\r\n    async #onCast(event) {\r\n        event.preventDefault()\r\n\r\n        const nb = this.element.find('[name=multi]').val()\r\n        if (nb < 1) {\r\n            localize.error('zero')\r\n            this.close()\r\n            return\r\n        }\r\n\r\n        const spell = this.spell\r\n        const damages = deepClone(spell._source.system.damage.value)\r\n        const heightening = deepClone(spell._source.system.heightening) ?? {}\r\n\r\n        for (const [id, damage] of Object.entries(damages)) {\r\n            for (let i = 0; i < nb - 1; i++) {\r\n                const newId = randomID()\r\n\r\n                damages[newId] = damage\r\n\r\n                if (heightening.type === 'interval') {\r\n                    const damage = heightening.damage[id]\r\n                    if (damage) heightening.damage[newId] = damage\r\n                } else if (heightening.type === 'fixed') {\r\n                    for (const [level, data] of Object.entries(heightening.levels)) {\r\n                        const damage = data.damage.value[id]\r\n                        if (damage) heightening.levels[level].damage.value[newId] = damage\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        const newSpell = spell.clone({ 'system.damage.value': damages, 'system.heightening': heightening })\r\n        newSpell.rollDamage(event)\r\n\r\n        this.close()\r\n    }\r\n\r\n    #onCancel(event) {\r\n        event.preventDefault()\r\n        this.close()\r\n    }\r\n}\r\n", "import { MultiCast } from '../apps/merge/multi'\r\nimport { MODULE_ID, getFlag, getSetting, localize, templatePath, warn } from '../module'\r\nimport { createHook } from './shared/hook'\r\n\r\nconst FLAVOR_TAGS = /<div class=\"tags\"><span class=\"tag\".+?<\\/div>/gm\r\nconst FLAVOR_MODIFIERS = /<span class=\"tag tag_transparent\">(.+?)<\\/span>/gm\r\nconst FORMULA_STRIP = /(\\[[\\w,]+\\])/\r\n\r\nconst setHook = createHook('renderChatMessage', renderChatMessage, updateMessages)\r\n\r\nexport function registerMerge() {\r\n    return {\r\n        settings: [\r\n            {\r\n                name: 'merge-damage',\r\n                type: Boolean,\r\n                default: false,\r\n                scope: 'client',\r\n                onChange: value => setHook(value, 'multi-cast'),\r\n            },\r\n            {\r\n                name: 'multi-cast',\r\n                type: Boolean,\r\n                default: false,\r\n                scope: 'client',\r\n                onChange: value => setHook(value, 'merge-damage'),\r\n            },\r\n        ],\r\n        init: isGm => {\r\n            setHook(false, ['multi-cast', 'merge-damage'])\r\n        },\r\n    }\r\n}\r\n\r\nfunction updateMessages() {\r\n    const chat = ui.chat?.element\r\n    if (!chat) return\r\n\r\n    for (const message of chatMessages(10)) {\r\n        const html = chat.find(`[data-message-id=${message.id}]`)\r\n        if (!html.length) continue\r\n\r\n        html.find('[data-action=multi-cast]').remove()\r\n        html.find('[data-action=merge-damage]').remove()\r\n\r\n        renderChatMessage(message, html)\r\n    }\r\n}\r\n\r\nfunction renderChatMessage(message, html) {\r\n    if (!game.user.isGM && !message.isAuthor) return\r\n    if (getSetting('merge-damage') && isDamageRoll(message)) renderDamage(message, html)\r\n    else if (getSetting('multi-cast') && message.getFlag('pf2e', 'origin.type') === 'spell') renderSpell(message, html)\r\n}\r\n\r\nfunction renderSpell(message, html) {\r\n    const uuid = message.getFlag('pf2e', 'origin.uuid')\r\n    if (!uuid) return\r\n\r\n    const spellBtn = html.find('.message-content .chat-card .owner-buttons .spell-button')\r\n\r\n    spellBtn\r\n        .find('[data-action=spell-damage]')\r\n        .after(`<button data-action=\"multi-cast\">${localize('merge.spell.button')}</button>`)\r\n\r\n    spellBtn.find('[data-action=multi-cast]').on('click', async event => {\r\n        const spell = await fromUuid(uuid)\r\n        if (spell) new MultiCast(spell).render(true)\r\n    })\r\n}\r\n\r\nfunction renderDamage(message, html) {\r\n    const uuid = getMessageUuid(message)\r\n    if (!uuid) return\r\n\r\n    const tooltip = localize('merge.damage.tooltip')\r\n    const button = `<span style=\"position: absolute; right: 0px; bottom: 1px;\">\r\n    <button data-action=\"merge-damage\" title=\"${tooltip}\" style=\"width: 22px; height: 22px; font-size: 10px; line-height: 1px;\">\r\n        <i class=\"fa-duotone fa-merge\"></i>\r\n    </button>\r\n</span>`\r\n\r\n    const originTarget = getMessageTarget(message)\r\n\r\n    html.find('.dice-result .dice-total').append(button)\r\n    html.find('[data-action=merge-damage]').on('click', event => {\r\n        event.stopPropagation()\r\n\r\n        for (const otherMessage of chatMessages(5, message)) {\r\n            if (\r\n                getMessageUuid(otherMessage) !== uuid ||\r\n                getMessageTarget(otherMessage) !== originTarget ||\r\n                !isDamageRoll(otherMessage)\r\n            )\r\n                continue\r\n\r\n            mergeDamages(event, message, otherMessage)\r\n            return\r\n        }\r\n\r\n        warn('merge.damage.none')\r\n    })\r\n}\r\n\r\nasync function mergeDamages(event, origin, other) {\r\n    const name = getItemName(origin, other)\r\n    const tags = getTags(origin, other)\r\n    const notes = getMessageNotes(other)\r\n    const modifiers = getMessageModifiers(other)\r\n\r\n    const target = getMessageTarget(origin)\r\n    const uuid = getMessageUuid(origin)\r\n\r\n    for (const note of getMessageNotes(origin)) {\r\n        if (!notes.includes(note)) notes.push(note)\r\n    }\r\n\r\n    for (const modifier of getMessageModifiers(origin)) {\r\n        if (!modifiers.includes(modifier)) modifiers.push(modifier)\r\n    }\r\n\r\n    const originRolls = getMessageRolls(origin)\r\n    const otherRolls = getMessageRolls(other)\r\n\r\n    const grouped = []\r\n\r\n    function findGroup(options) {\r\n        return grouped.find(({ options: { flavor, critRule } }) => flavor === options.flavor && critRule === options.critRule)\r\n    }\r\n\r\n    for (const roll of [].concat(otherRolls, originRolls)) {\r\n        const { options, total, terms } = roll\r\n        const term = terms[0]\r\n        const formula = roll.formula.replace(FORMULA_STRIP, '')\r\n        const group = findGroup(options)\r\n\r\n        if (group) {\r\n            group.terms.push(term)\r\n            group.total += total\r\n            group.formulas.push(formula)\r\n        } else {\r\n            grouped.push({\r\n                options,\r\n                formulas: [formula],\r\n                total,\r\n                terms: [term],\r\n            })\r\n        }\r\n    }\r\n\r\n    for (const group of grouped) {\r\n        group.formula = `(${group.formulas.join(' + ')})[${group.options.flavor}]`\r\n        group.term = group.terms.length < 2 ? group.terms[0] : createTermGroup(group.terms)\r\n    }\r\n\r\n    const roll = {\r\n        class: 'DamageRoll',\r\n        options: {},\r\n        dice: [],\r\n        formula: `{${grouped.map(({ formula }) => formula).join(', ')}}`,\r\n        total: grouped.reduce((acc, { total }) => acc + total, 0),\r\n        evaluated: true,\r\n        terms: [\r\n            {\r\n                class: 'InstancePool',\r\n                options: {},\r\n                evaluated: true,\r\n                terms: grouped.map(({ formula }) => formula),\r\n                modifiers: [],\r\n                rolls: grouped.map(({ options, formula, total, term }) => ({\r\n                    class: 'DamageInstance',\r\n                    options,\r\n                    dice: [],\r\n                    formula,\r\n                    total,\r\n                    terms: [term],\r\n                    evaluated: true,\r\n                })),\r\n                results: grouped.map(({ total }) => ({ result: total, active: true })),\r\n            },\r\n        ],\r\n    }\r\n\r\n    ui.chat.element.find(`[data-message-id=${origin.id}], [data-message-id=${other.id}]`).remove()\r\n    await ChatMessage.deleteDocuments([origin.id, other.id])\r\n\r\n    const flavor = await renderTemplate(templatePath('merge/merged'), {\r\n        header: localize('merge.merged.header', { name }),\r\n        tags,\r\n        notes,\r\n        modifiers,\r\n    })\r\n\r\n    await CONFIG.ChatMessage.documentClass.create({\r\n        flavor,\r\n        type: CONST.CHAT_MESSAGE_TYPES.ROLL,\r\n        speaker: origin.speaker,\r\n        flags: {\r\n            [MODULE_ID]: {\r\n                name,\r\n                tags,\r\n                notes,\r\n                modifiers,\r\n                uuid,\r\n                type: 'damage-roll',\r\n                target,\r\n                merged: true,\r\n            },\r\n        },\r\n        rolls: [roll],\r\n    })\r\n}\r\n\r\nfunction createTermGroup(terms) {\r\n    const options = deepClone(terms[0].options)\r\n    terms.map(term => ((term.options = {}), term))\r\n\r\n    return {\r\n        class: 'Grouping',\r\n        options,\r\n        evaluated: true,\r\n        term: {\r\n            class: 'ArithmeticExpression',\r\n            options: {},\r\n            evaluated: true,\r\n            operator: '+',\r\n            operands: [terms.shift(), terms.length > 1 ? createTermGroup(terms) : terms[0]],\r\n        },\r\n    }\r\n}\r\n\r\nfunction* chatMessages(nb, fromMessage) {\r\n    const messages = game.messages.contents\r\n    const start = (fromMessage ? messages.findLastIndex(m => m === fromMessage) : messages.length) - 1\r\n\r\n    for (let i = start; i >= start - nb; i--) {\r\n        const message = messages[i]\r\n        if (!message) return\r\n        yield message\r\n    }\r\n}\r\n\r\nfunction getMessageRolls(message) {\r\n    return getFlag(message, 'rolls') ?? JSON.parse(message._source.rolls[0]).terms[0].rolls\r\n}\r\n\r\nfunction getMessageUuid(message) {\r\n    return getMessageFlag(message, 'origin.uuid', 'uuid')\r\n}\r\n\r\nfunction isDamageRoll(message) {\r\n    return getMessageFlag(message, 'context.type', 'type') === 'damage-roll'\r\n}\r\n\r\nfunction getMessageTarget(message) {\r\n    return getMessageFlag(message, 'context.target.token', 'target')\r\n}\r\n\r\nfunction getItemName(m1, m2) {\r\n    return getFlag(m1, 'name') ?? getFlag(m2, 'name') ?? m1.getFlag('pf2e', 'strike.name') ?? m1.item.name\r\n}\r\n\r\nfunction getTags(m1, m2) {\r\n    return getFlag(m1, 'tags') ?? getFlag(m2, 'tags') ?? m1.flavor.match(FLAVOR_TAGS)?.[0] ?? ''\r\n}\r\n\r\nfunction getMessageNotes(message) {\r\n    return (\r\n        getFlag(message, 'notes') ??\r\n        message\r\n            .getFlag('pf2e', 'context.notes')\r\n            .map(({ title, text }) => `<strong>${game.i18n.localize(title)}</strong> ${game.i18n.localize(text)}`)\r\n    )\r\n}\r\n\r\nfunction getMessageModifiers(message) {\r\n    let modifiers = getFlag(message, 'modifiers')\r\n    if (modifiers) return modifiers\r\n\r\n    modifiers = []\r\n\r\n    let match\r\n    while ((match = FLAVOR_MODIFIERS.exec(message.flavor))) {\r\n        modifiers.push(match[1])\r\n    }\r\n\r\n    return modifiers\r\n}\r\n\r\nfunction getMessageFlag(message, systemFlag, moduleFlag) {\r\n    return message.getFlag('pf2e', systemFlag) ?? getFlag(message, moduleFlag)\r\n}\r\n", "import { getSetting, registerWrapper } from '../module'\r\n\r\nconst ACTOR_PREPARE_EMBEDDED_DOCUMENTS = 'CONFIG.Actor.documentClass.prototype.prepareEmbeddedDocuments'\r\n\r\nexport function registerNobulk() {\r\n    return {\r\n        settings: [\r\n            {\r\n                name: 'nobulk',\r\n                type: Boolean,\r\n                default: false,\r\n                requiresReload: true,\r\n            },\r\n        ],\r\n        init: () => {\r\n            if (!getSetting('nobulk')) return\r\n            registerWrapper(ACTOR_PREPARE_EMBEDDED_DOCUMENTS, actorPrepareEmbeddedDocuments, 'WRAPPER')\r\n        },\r\n    }\r\n}\r\n\r\nfunction actorPrepareEmbeddedDocuments(wrapped, ...args) {\r\n    wrapped(...args)\r\n\r\n    const actor = this\r\n    const InventoryBulk = actor.inventory.bulk.constructor\r\n\r\n    Object.defineProperty(actor.inventory, 'bulk', {\r\n        get() {\r\n            const inventoryBulk = new InventoryBulk(actor)\r\n            inventoryBulk.value = InventoryBulk.computeTotalBulk(\r\n                actor.inventory.filter(i => !i.isInContainer && i.system.equipped.carryType !== 'dropped'),\r\n                actor.size\r\n            )\r\n            return inventoryBulk\r\n        },\r\n    })\r\n}\r\n", "import { getSetting } from '../module'\r\n\r\nlet CREATE_HOOK = null\r\nlet UPDATE_HOOK = null\r\n\r\nexport function registerUnided() {\r\n    return {\r\n        settings: [\r\n            {\r\n                name: 'unided',\r\n                type: String,\r\n                default: 'disabled',\r\n                choices: ['disabled', 'create', 'all'],\r\n                onChange: setHooks,\r\n            },\r\n        ],\r\n        conflicts: ['pf2e-unided'],\r\n        init: () => {\r\n            setHooks()\r\n        },\r\n    }\r\n}\r\n\r\nfunction setHooks(value) {\r\n    value ??= getSetting('unided')\r\n\r\n    if (value === 'disabled') {\r\n        if (CREATE_HOOK) {\r\n            Hooks.off('preCreateItem', CREATE_HOOK)\r\n            CREATE_HOOK = null\r\n        }\r\n        if (UPDATE_HOOK) {\r\n            Hooks.off('preUpdateItem', UPDATE_HOOK)\r\n            UPDATE_HOOK = null\r\n        }\r\n    } else {\r\n        if (!CREATE_HOOK) {\r\n            CREATE_HOOK = Hooks.on('preCreateItem', preCreateItem)\r\n        }\r\n        if (value === 'all' && !UPDATE_HOOK) {\r\n            UPDATE_HOOK = Hooks.on('preUpdateItem', preUpdateItem)\r\n        } else if (value !== 'all' && UPDATE_HOOK) {\r\n            Hooks.off('preUpdateItem', UPDATE_HOOK)\r\n            UPDATE_HOOK = null\r\n        }\r\n    }\r\n}\r\n\r\nfunction preCreateItem(item) {\r\n    if (!item.img || !item.isOfType('physical')) return\r\n    item._source.system.identification.unidentified.img = item.img\r\n}\r\n\r\nfunction preUpdateItem(item, changes) {\r\n    if (!item.isOfType('physical') || !('img' in changes)) return\r\n    setProperty(changes, 'system.identification.unidentified.img', changes.img)\r\n}\r\n", "import { MODULE_ID, warn } from './module'\r\nimport { registerArp } from './modules/arp'\r\nimport { registerEffectsPanelHelper } from './modules/effects'\r\nimport { registerKnowledges } from './modules/knowledges'\r\nimport { registerMerge } from './modules/merge'\r\nimport { registerNobulk } from './modules/nobulk'\r\nimport { registerUnided } from './modules/unided'\r\n\r\nconst MODULES = [\r\n    registerArp(),\r\n    registerNobulk(),\r\n    registerKnowledges(),\r\n    registerUnided(),\r\n    registerMerge(),\r\n    registerEffectsPanelHelper(),\r\n]\r\nconst CONFLICTS = new Set()\r\n\r\nHooks.once('init', () => {\r\n    const user = game.data.users.find(x => x._id === game.data.userId)\r\n    const isGM = user && user.role >= CONST.USER_ROLES.GAMEMASTER\r\n\r\n    for (const module of MODULES) {\r\n        const { settings = [], init, conflicts = [] } = module\r\n\r\n        for (const setting of settings) {\r\n            const name = setting.name\r\n\r\n            if (setting.choices) {\r\n                setting.choices = setting.choices.reduce((choices, choice) => {\r\n                    choices[choice] = settingPath(name, `choices.${choice}`)\r\n                    return choices\r\n                }, {})\r\n            }\r\n\r\n            game.settings.register(MODULE_ID, name, {\r\n                scope: 'world',\r\n                config: true,\r\n                ...setting,\r\n                name: settingPath(name, 'name'),\r\n                hint: settingPath(name, 'hint'),\r\n            })\r\n        }\r\n\r\n        if (isGM) {\r\n            for (const id of conflicts) {\r\n                const conflictingModule = game.modules.get(id)\r\n                if (conflictingModule?.active) {\r\n                    module.conflicting = true\r\n                    CONFLICTS.add(conflictingModule.title)\r\n                }\r\n            }\r\n        }\r\n\r\n        if (!module.conflicting && init) init(isGM)\r\n    }\r\n})\r\n\r\nHooks.once('ready', () => {\r\n    const isGM = game.user.isGM\r\n\r\n    for (const { conflicting, ready } of MODULES) {\r\n        if (!conflicting && ready) ready(isGM)\r\n    }\r\n\r\n    if (isGM) {\r\n        for (const conflict of CONFLICTS) {\r\n            warn('module-conflict', { name: conflict }, true)\r\n        }\r\n    }\r\n})\r\n\r\nfunction settingPath(setting, key) {\r\n    return `${MODULE_ID}.settings.${setting}.${key}`\r\n}\r\n"],
  "mappings": "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",
  "names": ["MODULE_ID", "getSetting", "setting", "__name", "localize", "args", "key", "data", "hasLocalization", "localizePath", "subLocalize", "subKey", "fn", "warn", "info", "error", "hash", "notify", "str", "arg1", "arg2", "arg3", "type", "permanent", "registerWrapper", "path", "callback", "getFlag", "doc", "fallback", "setFlag", "value", "templatePath", "x", "PREPARE_WEAPON_DATA", "PREPARE_WEAPON_DERIVED_DATA", "PREPARE_ARMOR_DATA", "PREPARE_ARMOR_DERIVED_DATA", "WEAPON_EXCLUDES", "registerArp", "getSetting", "registerWrapper", "onPrepareWeaponData", "onPrepareWeaponDerivedData", "onPrepareArmorData", "onPrepareArmorDerivedData", "isGM", "info", "__name", "isValidActor", "actor", "isCharacter", "isValidWeapon", "weapon", "traits", "wrapped", "level", "WEAPON_POTENCY_PRICE", "WEAPON_STRIKING_PRICE", "gp", "potency", "striking", "isValidArmor", "armor", "ARMOR_POTENCY_PRICE", "ARMOR_RESILIENCY_PRICE", "resiliency", "createHook", "event", "listener", "callback", "HOOK", "value", "otherSettings", "s", "getSetting", "__name", "setHook", "createHook", "renderEffectsPanel", "refreshEffectsPanel", "registerEffectsPanelHelper", "value", "__name", "panel", "html", "removeRow", "localize", "editIcon", "effectPanels", "effectPanel", "id", "effect", "getSetting", "event", "onRemoveEffect", "h1", "onConditionSheet", "getEffect", "localize", "subLocalize", "EditLores", "templatePath", "options", "actor", "getFlag", "event", "unspecified", "specific", "setFlag", "html", "#onCancel", "__name", "setHook", "createHook", "renderNPCSheetPF2e", "registerKnowledges", "isGM", "getSetting", "__name", "sheet", "$html", "actor", "replaceLores", "addEditButton", "addEvents", "knowledgeSelector", "html", "section", "selector", "editLores", "EditLores", "unspecifics", "getFlag", "specifics", "lores", "body", "tag", "skills", "dc", "adjustment", "addTags", "start", "tags", "lore", "attempts", "edit", "localize", "subLocalize", "MultiCast", "spell", "options", "templatePath", "html", "#onCast", "#onCancel", "event", "nb", "damages", "heightening", "id", "damage", "i", "newId", "level", "data", "__name", "FLAVOR_TAGS", "FLAVOR_MODIFIERS", "FORMULA_STRIP", "setHook", "createHook", "renderChatMessage", "updateMessages", "registerMerge", "value", "isGm", "__name", "chat", "message", "chatMessages", "html", "getSetting", "isDamageRoll", "renderDamage", "renderSpell", "uuid", "spellBtn", "localize", "event", "spell", "MultiCast", "getMessageUuid", "button", "originTarget", "getMessageTarget", "otherMessage", "mergeDamages", "warn", "origin", "other", "name", "getItemName", "tags", "getTags", "notes", "getMessageNotes", "modifiers", "getMessageModifiers", "target", "note", "modifier", "originRolls", "getMessageRolls", "otherRolls", "grouped", "findGroup", "options", "flavor", "critRule", "roll", "total", "terms", "term", "formula", "group", "createTermGroup", "acc", "templatePath", "MODULE_ID", "nb", "fromMessage", "messages", "start", "m", "i", "getFlag", "getMessageFlag", "m1", "m2", "title", "text", "match", "systemFlag", "moduleFlag", "ACTOR_PREPARE_EMBEDDED_DOCUMENTS", "registerNobulk", "getSetting", "registerWrapper", "actorPrepareEmbeddedDocuments", "__name", "wrapped", "args", "actor", "InventoryBulk", "inventoryBulk", "i", "CREATE_HOOK", "UPDATE_HOOK", "registerUnided", "setHooks", "__name", "value", "getSetting", "preCreateItem", "preUpdateItem", "item", "changes", "MODULES", "registerArp", "registerNobulk", "registerKnowledges", "registerUnided", "registerMerge", "registerEffectsPanelHelper", "CONFLICTS", "user", "x", "isGM", "module", "settings", "init", "conflicts", "setting", "name", "choices", "choice", "settingPath", "MODULE_ID", "id", "conflictingModule", "conflicting", "ready", "conflict", "warn", "key", "__name"]
}
